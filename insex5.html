<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100%;
            color: #333;
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        html {
            height: 100%;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
        }

        /* Header */
        .site-header {
            background: linear-gradient(135deg, #8b0000 0%, #5c0000 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(139, 0, 0, 0.4);
            border: 3px solid #d4af37;
        }

        .site-header h1 {
            color: #d4af37;
            margin: 0 0 10px 0;
            font-size: 36px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.6);
        }

        .site-header p {
            color: #f5f5dc;
            margin: 0;
            font-size: 18px;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #d4af37;
            border-radius: 12px;
            color: #d4af37;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #d4af37 0%, #b8941e 100%);
            color: #1a1a2e;
        }

        /* Login Section */
        .login-section {
            max-width: 550px;
            margin: 0 auto;
            background: linear-gradient(135deg, #fff 0%, #f5f5dc 100%);
            padding: 50px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            border: 3px solid #d4af37;
        }

        .login-section h2 {
            color: #8b0000;
            text-align: center;
            margin-bottom: 35px;
            font-size: 32px;
        }

        .role-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 35px;
        }

        .role-btn {
            flex: 1;
            padding: 15px;
            background: #fff;
            border: 3px solid #d4af37;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            color: #16213e;
            transition: all 0.3s;
            text-align: center;
        }

        .role-btn:hover {
            background: #f5f5dc;
            transform: translateY(-2px);
        }

        .role-btn.active {
            background: linear-gradient(135deg, #8b0000 0%, #5c0000 100%);
            color: #d4af37;
            border-color: #8b0000;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #16213e;
            font-weight: bold;
            font-size: 18px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px 18px;
            border: 3px solid #d4af37;
            border-radius: 12px;
            font-size: 18px;
            background: #fff;
            color: #333;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #8b0000;
            box-shadow: 0 0 15px rgba(139, 0, 0, 0.3);
        }

        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #8b0000 0%, #5c0000 100%);
            color: #d4af37;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.5);
        }

        .login-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .welcome-banner {
            background: linear-gradient(135deg, #fff 0%, #f5f5dc 100%);
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid #d4af37;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .welcome-info h2 {
            color: #8b0000;
            margin: 0 0 15px 0;
            font-size: 30px;
        }

        .welcome-info p {
            color: #16213e;
            margin: 5px 0;
            font-size: 18px;
        }

        .logout-btn {
            background: #16213e;
            color: #d4af37;
            border: 3px solid #d4af37;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #d4af37;
            color: #16213e;
            transform: translateY(-2px);
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #d4af37;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .card h3 {
            color: #8b0000;
            margin: 0 0 25px 0;
            font-size: 24px;
            border-bottom: 3px solid #d4af37;
            padding-bottom: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #16213e;
            font-size: 16px;
        }

        .info-value {
            color: #555;
            font-size: 16px;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 18px 25px;
            background: linear-gradient(135deg, #16213e 0%, #0f2027 100%);
            color: #d4af37;
            border: 3px solid #d4af37;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
        }

        .action-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #d4af37 0%, #b8941e 100%);
            color: #16213e;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #555;
            border-color: #777;
        }

        .action-btn.success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: #fff;
            border-color: #28a745;
        }

        .action-btn.success:hover:not(:disabled) {
            background: linear-gradient(135deg, #218838 0%, #155724 100%);
        }

        .action-btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);
            color: #fff;
            border-color: #dc3545;
        }

        /* File Upload */
        .file-upload-area {
            border: 3px dashed #d4af37;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            background: #fff;
            transition: all 0.3s;
        }

        .file-upload-area:hover {
            background: #f5f5dc;
            border-color: #8b0000;
        }

        .file-upload-area input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #16213e 0%, #0f2027 100%);
            color: #d4af37;
            padding: 15px 35px;
            border-radius: 10px;
            cursor: pointer;
            display: inline-block;
            font-weight: bold;
            font-size: 18px;
            border: 3px solid #d4af37;
            transition: all 0.3s;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #d4af37 0%, #b8941e 100%);
            color: #16213e;
        }

        .file-name {
            margin-top: 15px;
            color: #28a745;
            font-weight: bold;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: center;
            border: 2px solid #d4af37;
        }

        .data-table th {
            background: linear-gradient(135deg, #8b0000 0%, #5c0000 100%);
            color: #d4af37;
            font-weight: bold;
            font-size: 16px;
        }

        .data-table td {
            color: #333;
            font-size: 15px;
        }

        .data-table tr:hover {
            background: #f5f5dc;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .status-present {
            background: #28a745;
            color: #fff;
        }

        .status-absent {
            background: #dc3545;
            color: #fff;
        }

        .status-excused {
            background: #ffc107;
            color: #000;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #fff 0%, #f5f5dc 100%);
            padding: 40px;
            border-radius: 25px;
            max-width: 900px;
            width: 100%;
            max-height: 90%;
            overflow-y: auto;
            border: 4px solid #d4af37;
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.6);
        }

        .modal-content h3 {
            color: #8b0000;
            margin: 0 0 30px 0;
            font-size: 28px;
            border-bottom: 3px solid #d4af37;
            padding-bottom: 15px;
        }

        .modal-close {
            background: #8b0000;
            color: #d4af37;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin-top: 25px;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #5c0000;
            transform: translateY(-2px);
        }

        /* Checkboxes */
        .checkbox-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #fff;
            border: 2px solid #d4af37;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .checkbox-item:hover {
            background: #f5f5dc;
            transform: translateX(-3px);
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-size: 16px;
            color: #333;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff 0%, #f5f5dc 100%);
            padding: 30px;
            border-radius: 18px;
            text-align: center;
            border: 3px solid #d4af37;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        }

        .stat-number {
            font-size: 42px;
            font-weight: bold;
            color: #8b0000;
            margin-bottom: 12px;
        }

        .stat-label {
            color: #16213e;
            font-size: 18px;
            font-weight: bold;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #28a745;
            color: #fff;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            display: none;
            font-size: 18px;
            font-weight: bold;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.warning {
            background: #ffc107;
            color: #000;
        }

        .toast.show {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading State */
        .loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #d4af37;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .site-header h1 {
                font-size: 26px;
            }

            .login-section {
                padding: 30px;
            }

            .role-selector {
                flex-direction: column;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .welcome-banner {
                flex-direction: column;
                text-align: center;
            }

            .checkbox-list {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Grade Input */
        .grade-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #d4af37;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
        }

        .save-grades-btn {
            background: #28a745;
            color: #fff;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .save-grades-btn:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
        }

        .save-grades-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results Display */
        .results-card {
            background: linear-gradient(135deg, #fff 0%, #f5f5dc 100%);
            padding: 35px;
            border-radius: 20px;
            border: 3px solid #d4af37;
            margin-top: 25px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .results-header h2 {
            color: #8b0000;
            font-size: 32px;
            margin: 0 0 10px 0;
        }

        .results-table {
            width: 100%;
            margin-top: 20px;
        }

        .results-table th,
        .results-table td {
            padding: 15px;
            text-align: center;
            border: 2px solid #d4af37;
        }

        .results-table th {
            background: #8b0000;
            color: #d4af37;
            font-weight: bold;
        }

        .total-row {
            background: #f5f5dc;
            font-weight: bold;
            font-size: 18px;
        }

        /* Permission Badge */
        .permission-badge {
            display: inline-block;
            padding: 5px 12px;
            background: #28a745;
            color: #fff;
            border-radius: 15px;
            font-size: 14px;
            margin: 3px;
        }

        .permission-badge.inactive {
            background: #6c757d;
        }

        /* Week Selector */
        .week-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .week-btn {
            padding: 10px 20px;
            background: #fff;
            border: 2px solid #d4af37;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .week-btn:hover {
            background: #f5f5dc;
        }

        .week-btn.active {
            background: #8b0000;
            color: #d4af37;
            border-color: #8b0000;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
        }

        /* Chart Container */
        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: #fff;
            border-radius: 15px;
            border: 2px solid #d4af37;
        }

        .bar-chart {
            display: flex;
            gap: 15px;
            height: 300px;
            align-items: flex-end;
            justify-content: space-around;
            padding: 20px;
        }

        .bar {
            flex: 1;
            background: linear-gradient(135deg, #8b0000 0%, #5c0000 100%);
            border-radius: 8px 8px 0 0;
            position: relative;
            min-width: 60px;
            transition: all 0.3s;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: #8b0000;
        }

        /* Radio Buttons for Attendance */
        .attendance-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-item input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-item label {
            cursor: pointer;
            font-size: 15px;
        }

        /* Info Box */
        .info-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            color: #856404;
        }

        .info-box strong {
            display: block;
            margin-bottom: 10px;
            font-size: 18px;
        }

        /* Student List Item */
        .student-list-item {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #d4af37;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .student-list-item:hover {
            background: #f5f5dc;
            transform: translateX(-5px);
        }

        .student-info {
            flex: 1;
        }

        .student-info h4 {
            margin: 0 0 8px 0;
            color: #8b0000;
            font-size: 20px;
        }

        .student-info p {
            margin: 5px 0;
            color: #555;
            font-size: 15px;
        }

        .student-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            padding: 10px 15px;
            border: 2px solid #d4af37;
            border-radius: 8px;
            cursor: pointer;
            background: #fff;
            transition: all 0.3s;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: #d4af37;
            color: #fff;
        }

        /* Select Dropdown */
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #d4af37;
            border-radius: 8px;
            font-size: 16px;
            background: #fff;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #8b0000;
        }

        /* Grade Summary */
        .grade-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .grade-summary-item {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #d4af37;
            text-align: center;
        }

        .grade-summary-item .subject {
            font-weight: bold;
            color: #8b0000;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .grade-summary-item .average {
            font-size: 32px;
            font-weight: bold;
            color: #28a745;
        }

        /* Attendance Radio Group */
        .attendance-radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .attendance-student-card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #d4af37;
        }

        .attendance-student-card h4 {
            margin: 0 0 15px 0;
            color: #8b0000;
            font-size: 18px;
            border-bottom: 2px solid #d4af37;
            padding-bottom: 10px;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <header class="site-header">
    <h1>ğŸµ Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</h1>
    <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2024-2025</p>
   </header><!-- Login Section -->
   <div id="loginSection">
    <div class="login-section">
     <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
     <div class="role-selector"><button class="role-btn active" onclick="selectRole('student')"> ğŸ‘¨â€ğŸ“ Ø¯Ø§Ø±Ø³ </button> <button class="role-btn" onclick="selectRole('teacher')"> ğŸ‘¨â€ğŸ« Ø®Ø§Ø¯Ù… </button>
     </div>
     <form id="loginForm" onsubmit="handleLogin(event)"><!-- Student Login -->
      <div id="studentLoginForm">
       <div class="form-group"><label for="studentCode">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³</label> <input type="text" id="studentCode" placeholder="Ù…Ø«Ø§Ù„: VK29JM73" required>
       </div>
      </div><!-- Teacher Login -->
      <div id="teacherLoginForm" class="hidden">
       <div class="form-group"><label for="teacherCode">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…</label> <input type="text" id="teacherCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…">
       </div>
       <div class="form-group"><label for="teacherPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> <input type="password" id="teacherPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
       </div>
      </div><button type="submit" class="login-btn" id="loginBtn">Ø¯Ø®ÙˆÙ„ ğŸš€</button>
     </form>
     <div class="info-box" style="margin-top: 25px;"><strong>ğŸ”‘ Ø­Ø³Ø§Ø¨Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©:</strong> <span>Ø¯Ø§Ø±Ø³: VK29JM73 | Ø®Ø§Ø¯Ù…: TEACH001 / teacher123</span>
     </div>
     <div class="info-box" id="debugInfo"><strong>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:</strong>
      <div id="debugText">
       Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
      </div>
     </div>
    </div>
   </div><!-- Student Dashboard -->
   <div id="studentDashboard" class="dashboard">
    <div class="welcome-banner">
     <div class="welcome-info">
      <h2 id="studentWelcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
      <p id="studentInfo">ğŸ“š <strong>Ø§Ù„ØµÙ:</strong> <span id="studentClass"></span></p>
      <p>ğŸ“ <strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> <span id="studentPhone"></span></p>
      <p>ğŸ†” <strong>Ø§Ù„ÙƒÙˆØ¯:</strong> <span id="studentCodeDisplay"></span></p>
     </div><button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div><!-- Student Stats -->
    <div class="stats-grid">
     <div class="stat-card">
      <div class="stat-number" id="studentAttendanceRate">
       87%
      </div>
      <div class="stat-label">
       Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="studentWeeklyAvg">
       85
      </div>
      <div class="stat-label">
       Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="studentTerm1Avg">
       --
      </div>
      <div class="stat-label">
       Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="studentTerm2Avg">
       --
      </div>
      <div class="stat-label">
       Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ
      </div>
     </div>
    </div>
    <div class="cards-grid"><!-- Grades Progress Card -->
     <div class="card">
      <h3>ğŸ“Š ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
      <div class="grade-summary">
       <div class="grade-summary-item">
        <div class="subject">
         Ø§Ù„Ø·Ù‚ÙˆØ³
        </div>
        <div class="average" id="liturgyAvgStudent">
         --
        </div>
       </div>
       <div class="grade-summary-item">
        <div class="subject">
         Ø§Ù„Ù‚Ø¨Ø·ÙŠ
        </div>
        <div class="average" id="copticAvgStudent">
         --
        </div>
       </div>
       <div class="grade-summary-item">
        <div class="subject">
         Ø§Ù„Ø£Ù„Ø­Ø§Ù†
        </div>
        <div class="average" id="hymnsAvgStudent">
         --
        </div>
       </div>
      </div><button class="action-btn" onclick="viewDetailedGrades()" style="width: 100%; margin-top: 15px;"> Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø© </button>
     </div><!-- Upload Assignments Card -->
     <div class="card">
      <h3>ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h3>
      <div class="action-buttons"><button class="action-btn" onclick="openUploadModal('liturgy')"> ğŸ“– ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø·Ù‚ÙˆØ³ </button> <button class="action-btn" onclick="openUploadModal('coptic')"> ğŸ“ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ù‚Ø¨Ø·ÙŠ </button> <button class="action-btn" onclick="openUploadModal('hymns')"> ğŸµ ØªØ³Ù…ÙŠØ¹ Ø§Ù„Ø£Ù„Ø­Ø§Ù† </button>
      </div>
      <p style="margin-top: 20px; color: #555; font-size: 15px; text-align: center;">ğŸ’¡ ÙŠØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
     </div><!-- Attendance Card -->
     <div class="card">
      <h3>âœ… Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
      <div class="stats-grid">
       <div class="stat-card">
        <div class="stat-number" id="presentCount">
         0
        </div>
        <div class="stat-label">
         Ø­Ø§Ø¶Ø±
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-number" id="absentCount">
         0
        </div>
        <div class="stat-label">
         ØºØ§Ø¦Ø¨
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-number" id="excusedCount">
         0
        </div>
        <div class="stat-label">
         Ø¨Ø¥Ø°Ù†
        </div>
       </div>
      </div><button class="action-btn success" onclick="viewAttendanceDetails()" style="margin-top: 15px; width: 100%;"> Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ </button>
     </div>
    </div><!-- Results Section -->
    <div class="card">
     <h3>ğŸ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h3>
     <div class="action-buttons"><button class="action-btn" onclick="viewResults('midterm1')"> ğŸ“„ Ù…ÙŠØ¯ØªØ±Ù… Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„ </button> <button class="action-btn" onclick="viewResults('final1')"> ğŸ“‹ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„ </button> <button class="action-btn" onclick="viewResults('midterm2')"> ğŸ“„ Ù…ÙŠØ¯ØªØ±Ù… Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ </button> <button class="action-btn" onclick="viewResults('final2')"> ğŸ“‹ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ </button>
     </div>
    </div>
   </div><!-- Teacher Dashboard -->
   <div id="teacherDashboard" class="dashboard">
    <div class="welcome-banner">
     <div class="welcome-info">
      <h2 id="teacherWelcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø³ØªØ§Ø° ğŸ‘‹</h2>
      <p>ğŸ¯ <strong>Ø§Ù„ØªØ®ØµØµ:</strong> <span id="teacherSpecialization"></span></p>
      <p>ğŸ“š <strong>Ø§Ù„ÙØµÙˆÙ„:</strong> <span id="teacherClasses"></span></p>
      <p>ğŸ†” <strong>Ø§Ù„ÙƒÙˆØ¯:</strong> <span id="teacherCodeDisplay"></span></p>
     </div><button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div><!-- Teacher Stats -->
    <div class="stats-grid">
     <div class="stat-card">
      <div class="stat-number" id="totalStudentsCount">
       0
      </div>
      <div class="stat-label">
       Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="myStudentsCount">
       0
      </div>
      <div class="stat-label">
       Ø¯Ø§Ø±Ø³ÙŠ ÙØµÙˆÙ„ÙŠ
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="avgAttendanceRate">
       0%
      </div>
      <div class="stat-label">
       Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±
      </div>
     </div>
     <div class="stat-card">
      <div class="stat-number" id="avgClassGrade">
       0
      </div>
      <div class="stat-label">
       Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„
      </div>
     </div>
    </div>
    <div class="cards-grid"><!-- Attendance Management -->
     <div class="card">
      <h3>âœ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
      <div class="action-buttons"><button class="action-btn" id="viewTeacherAttendanceBtn" onclick="viewTeacherAttendance()"> ğŸ“Š Ø­Ø¶ÙˆØ±ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ </button> <button class="action-btn" id="requestAbsenceBtn" onclick="requestAbsence()"> ğŸ“ Ø·Ù„Ø¨ Ø§Ø¹ØªØ°Ø§Ø± </button> <button class="action-btn" id="recordStudentAttendanceBtn" onclick="recordStudentAttendance()"> âœï¸ ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨ </button> <button class="action-btn" onclick="viewAttendanceReports()"> ğŸ“ˆ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± </button>
      </div>
     </div><!-- Grades Management -->
     <div class="card">
      <h3>ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
      <div class="action-buttons"><button class="action-btn" id="liturgyGradesBtn" onclick="openGradesModal('liturgy')"> ğŸ“– Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù‚ÙˆØ³ </button> <button class="action-btn" id="copticGradesBtn" onclick="openGradesModal('coptic')"> ğŸ“ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠ </button> <button class="action-btn" id="hymnsGradesBtn" onclick="openGradesModal('hymns')"> ğŸµ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø£Ù„Ø­Ø§Ù† </button> <button class="action-btn" onclick="viewGradesSummary()"> ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª </button>
      </div>
     </div><!-- Preparation Upload -->
     <div class="card">
      <h3>ğŸ“š Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¶ÙŠØ±</h3>
      <div class="file-upload-area"><input type="file" id="preparationFile" accept=".pdf,.doc,.docx" onchange="handlePreparationUpload(event)"> <label for="preparationFile" class="upload-btn"> ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ </label>
       <div class="file-name" id="preparationFileName"></div>
      </div>
      <p style="margin-top: 15px; color: #555; text-align: center;">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¶ÙŠØ± ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
     </div><!-- Control Team Actions -->
     <div class="card" id="controlTeamCard">
      <h3>âš™ï¸ ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒÙ†ØªØ±ÙˆÙ„</h3>
      <div class="action-buttons"><button class="action-btn success" id="addStudentBtn" onclick="openAddStudentModal()"> â• ØªØ³Ø¬ÙŠÙ„ Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯ </button> <button class="action-btn" id="manageStudentsBtn" onclick="manageStudents()"> ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† </button> <button class="action-btn" onclick="manageTeachers()"> ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ø§Ù… </button> <button class="action-btn" id="generateReportsBtn" onclick="generateReports()"> ğŸ“ˆ ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© </button>
      </div>
     </div>
    </div>
   </div><!-- Upload Modal -->
   <div id="uploadModal" class="modal">
    <div class="modal-content">
     <h3 id="uploadModalTitle">Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨</h3>
     <div class="file-upload-area"><input type="file" id="assignmentFile" accept="image/*,.pdf,audio/*" onchange="handleFileSelect(event)"> <label for="assignmentFile" class="upload-btn"> ğŸ“ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù </label>
      <div class="file-name" id="selectedFileName"></div>
     </div>
     <p style="margin-top: 20px; color: #555;">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©: ØµÙˆØ± (JPG, PNG) - PDF - Ù…Ù„ÙØ§Øª ØµÙˆØªÙŠØ© (MP3, M4A)</p><button class="action-btn success" onclick="uploadAssignment()" style="width: 100%; margin-top: 20px;"> âœ… Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨ </button> <button class="modal-close" onclick="closeModal('uploadModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Results Modal -->
   <div id="resultsModal" class="modal">
    <div class="modal-content">
     <div class="results-card">
      <div class="results-header">
       <h2 id="resultsTitle">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
       <p><strong>Ø§Ù„Ø¯Ø§Ø±Ø³:</strong> <span id="resultsStudentName"></span></p>
       <p><strong>Ø§Ù„ÙƒÙˆØ¯:</strong> <span id="resultsStudentCode"></span></p>
      </div>
      <table class="results-table">
       <thead>
        <tr>
         <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
         <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
         <th>Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø¸Ù…Ù‰</th>
        </tr>
       </thead>
       <tbody id="resultsTableBody">
       </tbody>
      </table>
     </div><button class="modal-close" onclick="closeModal('resultsModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Attendance Details Modal -->
   <div id="attendanceModal" class="modal">
    <div class="modal-content">
     <h3>ğŸ“… Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h3>
     <table class="data-table">
      <thead>
       <tr>
        <th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
       </tr>
      </thead>
      <tbody id="attendanceTableBody">
      </tbody>
     </table><button class="modal-close" onclick="closeModal('attendanceModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Record Attendance Modal -->
   <div id="recordAttendanceModal" class="modal">
    <div class="modal-content">
     <h3>âœï¸ ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
     <div class="form-group"><label for="attendanceWeek">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label> <select id="attendanceWeek"> <option value="1">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1</option> <option value="2">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2</option> <option value="3">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3</option> <option value="4">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4</option> <option value="5">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5</option> <option value="6">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 6</option> <option value="7">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 7</option> <option value="8">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 8</option> <option value="9">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 9</option> <option value="10">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 10</option> <option value="11">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 11</option> <option value="12">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 12</option> <option value="13">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 13</option> <option value="14">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 14</option> <option value="15">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 15</option> </select>
     </div>
     <div id="studentAttendanceList" class="attendance-radio-group">
     </div><button class="save-grades-btn" onclick="saveAttendance()" style="width: 100%;"> ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ± </button> <button class="modal-close" onclick="closeModal('recordAttendanceModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Grades Modal -->
   <div id="gradesModal" class="modal">
    <div class="modal-content">
     <h3 id="gradesModalTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
     <div class="form-group"><label for="gradeType">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label> <select id="gradeType"> <option value="weekly_1">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1</option> <option value="weekly_2">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2</option> <option value="weekly_3">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3</option> <option value="weekly_4">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4</option> <option value="weekly_5">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5</option> <option value="weekly_6">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 6</option> <option value="weekly_7">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 7</option> <option value="weekly_8">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 8</option> <option value="midterm_1">Ù…ÙŠØ¯ØªØ±Ù… Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„</option> <option value="final_1">ÙØ§ÙŠÙ†Ø§Ù„ Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„</option> <option value="midterm_2">Ù…ÙŠØ¯ØªØ±Ù… Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</option> <option value="final_2">ÙØ§ÙŠÙ†Ø§Ù„ Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</option> </select>
     </div>
     <table class="data-table">
      <thead>
       <tr>
        <th>Ø§Ù„Ø¯Ø§Ø±Ø³</th>
        <th>Ø§Ù„ÙƒÙˆØ¯</th>
        <th>Ø§Ù„ÙØµÙ„</th>
        <th>Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 100)</th>
       </tr>
      </thead>
      <tbody id="gradesTableBody">
      </tbody>
     </table><button class="save-grades-btn" onclick="saveGrades()" style="width: 100%;"> ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª </button> <button class="modal-close" onclick="closeModal('gradesModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Add Student Modal -->
   <div id="addStudentModal" class="modal">
    <div class="modal-content">
     <h3>â• ØªØ³Ø¬ÙŠÙ„ Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h3>
     <form id="addStudentForm" onsubmit="addNewStudent(event)">
      <div class="form-group"><label for="newStudentName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label> <input type="text" id="newStudentName" required>
      </div>
      <div class="form-group"><label for="newStudentClass">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label> <select id="newStudentClass"> <option value="ØªÙ…Ù‡ÙŠØ¯ÙŠ">ØªÙ…Ù‡ÙŠØ¯ÙŠ</option> <option value="Ø£ÙˆÙ„Ù‰ ÙˆØ«Ø§Ù†ÙŠØ©">Ø£ÙˆÙ„Ù‰ ÙˆØ«Ø§Ù†ÙŠØ©</option> <option value="Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©">Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©</option> <option value="Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©">Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©</option> <option value="Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ ÙˆØ«Ø§Ù†ÙˆÙŠ">Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ ÙˆØ«Ø§Ù†ÙˆÙŠ</option> <option value="Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†">Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†</option> </select>
      </div>
      <div class="form-group"><label for="newStudentPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label> <input type="text" id="newStudentPhone" required>
      </div>
      <div class="form-group"><label for="newStudentParentPhone">Ø±Ù‚Ù… Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</label> <input type="text" id="newStudentParentPhone" required>
      </div><button type="submit" class="action-btn success" style="width: 100%;"> âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³ </button>
     </form><button class="modal-close" onclick="closeModal('addStudentModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Manage Students Modal -->
   <div id="manageStudentsModal" class="modal">
    <div class="modal-content">
     <h3>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h3>
     <div class="form-group"><label for="filterClass">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„</label> <select id="filterClass" onchange="filterStudentsList()"> <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option> <option value="ØªÙ…Ù‡ÙŠØ¯ÙŠ">ØªÙ…Ù‡ÙŠØ¯ÙŠ</option> <option value="Ø£ÙˆÙ„Ù‰ ÙˆØ«Ø§Ù†ÙŠØ©">Ø£ÙˆÙ„Ù‰ ÙˆØ«Ø§Ù†ÙŠØ©</option> <option value="Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©">Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©</option> <option value="Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©">Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©</option> <option value="Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ ÙˆØ«Ø§Ù†ÙˆÙŠ">Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ ÙˆØ«Ø§Ù†ÙˆÙŠ</option> <option value="Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†">Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†</option> </select>
     </div>
     <div id="studentsListContainer">
     </div><button class="modal-close" onclick="closeModal('manageStudentsModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Detailed Grades Modal -->
   <div id="detailedGradesModal" class="modal">
    <div class="modal-content">
     <h3>ğŸ“Š Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h3>
     <div id="detailedGradesContent">
     </div><button class="modal-close" onclick="closeModal('detailedGradesModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Grades Summary Modal -->
   <div id="gradesSummaryModal" class="modal">
    <div class="modal-content">
     <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„</h3>
     <div class="chart-container">
      <h4 style="text-align: center; color: #8b0000; margin-bottom: 20px;">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙØµÙ„ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯</h4>
      <div class="bar-chart" id="subjectAverageChart">
      </div>
     </div>
     <div id="gradesSummaryContent">
     </div><button class="modal-close" onclick="closeModal('gradesSummaryModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Attendance Reports Modal -->
   <div id="attendanceReportsModal" class="modal">
    <div class="modal-content">
     <h3>ğŸ“ˆ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h3>
     <div class="stats-grid">
      <div class="stat-card">
       <div class="stat-number" id="reportTotalStudents">
        0
       </div>
       <div class="stat-label">
        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="reportAvgAttendance">
        0%
       </div>
       <div class="stat-label">
        Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø¶ÙˆØ±
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="reportTotalPresent">
        0
       </div>
       <div class="stat-label">
        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¶ÙˆØ±
       </div>
      </div>
      <div class="stat-card">
       <div class="stat-number" id="reportTotalAbsent">
        0
       </div>
       <div class="stat-label">
        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºÙŠØ§Ø¨
       </div>
      </div>
     </div>
     <div class="chart-container">
      <h4 style="text-align: center; color: #8b0000; margin-bottom: 20px;">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„</h4>
      <div class="bar-chart" id="classAttendanceChart">
      </div>
     </div>
     <div id="attendanceReportsContent">
     </div><button class="modal-close" onclick="closeModal('attendanceReportsModal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="toast"></div>
  </div>
  <script>
        let currentUser = null;
        let currentRole = 'student';
        let allUsers = [];
        let currentSubject = '';
        let isDataLoaded = false;

        const dataHandler = {
            onDataChanged(data) {
                allUsers = data;
                isDataLoaded = true;
                updateDebugInfo();
                
                if (currentUser) {
                    const updatedUser = allUsers.find(u => u.__backendId === currentUser.__backendId);
                    if (updatedUser) {
                        currentUser = updatedUser;
                        updateDashboard();
                    }
                }
            }
        };

        async function initApp() {
            updateDebugInfo('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    updateDebugInfo('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + result.error);
                    showToast('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    return;
                }

                await new Promise(resolve => setTimeout(resolve, 800));

                if (allUsers.length === 0) {
                    updateDebugInfo('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
                    await createDemoData();
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
                
                updateDebugInfo();
            } else {
                updateDebugInfo('âŒ Data SDK ØºÙŠØ± Ù…ØªÙˆÙØ±');
            }
        }

        function updateDebugInfo(message = null) {
            const debugText = document.getElementById('debugText');
            if (message) {
                debugText.innerHTML = message;
            } else {
                const studentCount = allUsers.filter(u => u.type === 'student').length;
                const teacherCount = allUsers.filter(u => u.type === 'teacher').length;
                debugText.innerHTML = `
                    âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­<br>
                    ğŸ‘¨â€ğŸ“ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†: ${studentCount}<br>
                    ğŸ‘¨â€ğŸ« Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø¯Ø§Ù…: ${teacherCount}<br>
                    ğŸ“¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${allUsers.length}
                `;
            }
        }

        async function createDemoData() {
            const demoData = [
                {
                    type: 'student',
                    name: 'Ù…ÙŠÙ†Ø§ Ø¬ÙˆØ±Ø¬ ÙÙ‡Ù…ÙŠ',
                    code: 'VK29JM73',
                    class: 'Ø£ÙˆÙ„Ù‰ ÙˆØ«Ø§Ù†ÙŠØ©',
                    phone: '01234567890',
                    parent_phone: '01098765432',
                    enrollment_date: '2024-09-01',
                    active: true,
                    createdAt: new Date().toISOString(),
                    attendance_week_1: 'present',
                    attendance_week_2: 'present',
                    attendance_week_3: 'absent',
                    attendance_week_4: 'present',
                    liturgy_weekly_1: 85,
                    liturgy_weekly_2: 88,
                    liturgy_weekly_3: 82,
                    liturgy_weekly_4: 90,
                    coptic_weekly_1: 90,
                    coptic_weekly_2: 92,
                    coptic_weekly_3: 88,
                    coptic_weekly_4: 95,
                    hymns_weekly_1: 88,
                    hymns_weekly_2: 85,
                    hymns_weekly_3: 90,
                    hymns_weekly_4: 87,
                    liturgy_midterm_1: 85,
                    coptic_midterm_1: 90,
                    hymns_midterm_1: 88
                },
                {
                    type: 'student',
                    name: 'Ù…Ø±ÙŠÙ… Ø¨Ø·Ø±Ø³ Ø¹Ø¨Ø¯Ù‡',
                    code: 'ST45XY89',
                    class: 'Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©',
                    phone: '01112223334',
                    parent_phone: '01555666777',
                    enrollment_date: '2024-09-01',
                    active: true,
                    createdAt: new Date().toISOString(),
                    attendance_week_1: 'present',
                    attendance_week_2: 'present',
                    attendance_week_3: 'present',
                    attendance_week_4: 'present',
                    liturgy_weekly_1: 92,
                    liturgy_weekly_2: 94,
                    coptic_weekly_1: 88,
                    coptic_weekly_2: 90,
                    hymns_weekly_1: 95,
                    hymns_weekly_2: 93
                },
                {
                    type: 'student',
                    name: 'ÙƒÙŠØ±Ù„Ø³ ÙŠÙˆØ³Ù Ù…Ù„Ø§Ùƒ',
                    code: 'KY78MN12',
                    class: 'Ø£ÙˆÙ„Ù‰ ÙˆØ«Ø§Ù†ÙŠØ©',
                    phone: '01223344556',
                    parent_phone: '01667788990',
                    enrollment_date: '2024-09-01',
                    active: true,
                    createdAt: new Date().toISOString(),
                    attendance_week_1: 'present',
                    attendance_week_2: 'excused',
                    liturgy_weekly_1: 78,
                    coptic_weekly_1: 82,
                    hymns_weekly_1: 80
                },
                {
                    type: 'teacher',
                    name: 'Ø£Ø¨ÙˆÙ†Ø§ ÙŠÙˆØ­Ù†Ø§ Ù…Ø±Ù‚Ø³',
                    code: 'TEACH001',
                    password: 'teacher123',
                    phone: '01001002003',
                    specializations: JSON.stringify(['Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©']),
                    class_levels: JSON.stringify(['Ø£ÙˆÙ„Ù‰ ÙˆØ«Ø§Ù†ÙŠØ©', 'Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©']),
                    permissions: JSON.stringify({
                        can_view_attendance: true,
                        can_record_attendance: true,
                        can_record_grades: ['liturgy'],
                        is_control_team: false,
                        is_admin: false
                    }),
                    active: true,
                    createdAt: new Date().toISOString()
                },
                {
                    type: 'teacher',
                    name: 'Ø§Ù„Ø´Ù…Ø§Ø³ Ø¨ÙˆÙ„Ø³ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…',
                    code: 'TEACH002',
                    password: 'teacher456',
                    phone: '01201202203',
                    specializations: JSON.stringify(['Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©', 'Ø§Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„ØªØ³Ø¨Ø­Ø©']),
                    class_levels: JSON.stringify(['Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©']),
                    permissions: JSON.stringify({
                        can_view_attendance: true,
                        can_record_attendance: true,
                        can_record_grades: ['coptic', 'hymns'],
                        is_control_team: true,
                        is_admin: false
                    }),
                    active: true,
                    createdAt: new Date().toISOString()
                }
            ];

            for (const data of demoData) {
                if (window.dataSdk) {
                    const result = await window.dataSdk.create(data);
                    if (!result.isOk) {
                        console.error('Failed to create demo data:', result.error);
                    }
                }
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ âœ…');
        }

        function selectRole(role) {
            currentRole = role;
            
            const roleBtns = document.querySelectorAll('.role-btn');
            roleBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('studentLoginForm').classList.add('hidden');
            document.getElementById('teacherLoginForm').classList.add('hidden');

            if (role === 'student') {
                document.getElementById('studentLoginForm').classList.remove('hidden');
            } else {
                document.getElementById('teacherLoginForm').classList.remove('hidden');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            if (!isDataLoaded) {
                showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 'warning');
                return;
            }

            const btn = document.getElementById('loginBtn');
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚... â³';
            btn.disabled = true;

            await new Promise(resolve => setTimeout(resolve, 800));

            if (currentRole === 'student') {
                const code = document.getElementById('studentCode').value.trim().toUpperCase();
                const user = allUsers.find(u => u.type === 'student' && u.code.toUpperCase() === code);
                
                if (user) {
                    currentUser = user;
                    showDashboard('student');
                    showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                } else {
                    showToast(`ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³ "${code}" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©`, 'error');
                }
            } else {
                const code = document.getElementById('teacherCode').value.trim().toUpperCase();
                const password = document.getElementById('teacherPassword').value;
                const user = allUsers.find(u => 
                    u.type === 'teacher' && 
                    u.code.toUpperCase() === code && 
                    u.password === password
                );
                
                if (user) {
                    currentUser = user;
                    showDashboard('teacher');
                    showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø³ØªØ§Ø°! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                } else {
                    showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                }
            }

            btn.textContent = 'Ø¯Ø®ÙˆÙ„ ğŸš€';
            btn.disabled = false;
        }

        function showDashboard(type) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('studentDashboard').classList.remove('active');
            document.getElementById('teacherDashboard').classList.remove('active');

            if (type === 'student') {
                document.getElementById('studentDashboard').classList.add('active');
                updateStudentDashboard();
            } else {
                document.getElementById('teacherDashboard').classList.add('active');
                updateTeacherDashboard();
            }
        }

        function calculateAttendanceStats(student) {
            let present = 0, absent = 0, excused = 0, total = 0;
            
            for (let i = 1; i <= 15; i++) {
                const attendance = student[`attendance_week_${i}`];
                if (attendance) {
                    total++;
                    if (attendance === 'present') present++;
                    else if (attendance === 'absent') absent++;
                    else if (attendance === 'excused') excused++;
                }
            }
            
            const rate = total > 0 ? Math.round((present / total) * 100) : 0;
            return { present, absent, excused, rate };
        }

        function calculateGradeAverage(student, subject) {
            let sum = 0, count = 0;
            
            for (let i = 1; i <= 8; i++) {
                const grade = student[`${subject}_weekly_${i}`];
                if (grade != null && grade !== '') {
                    sum += parseFloat(grade);
                    count++;
                }
            }
            
            return count > 0 ? Math.round(sum / count) : null;
        }

        function updateStudentDashboard() {
            if (!currentUser) return;

            document.getElementById('studentWelcome').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name} ğŸ‘‹`;
            document.getElementById('studentName').textContent = currentUser.name;
            document.getElementById('studentClass').textContent = currentUser.class || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('studentPhone').textContent = currentUser.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('studentCodeDisplay').textContent = currentUser.code;

            // Attendance stats
            const attendanceStats = calculateAttendanceStats(currentUser);
            document.getElementById('studentAttendanceRate').textContent = attendanceStats.rate + '%';
            document.getElementById('presentCount').textContent = attendanceStats.present;
            document.getElementById('absentCount').textContent = attendanceStats.absent;
            document.getElementById('excusedCount').textContent = attendanceStats.excused;

            // Grade averages
            const liturgyAvg = calculateGradeAverage(currentUser, 'liturgy');
            const copticAvg = calculateGradeAverage(currentUser, 'coptic');
            const hymnsAvg = calculateGradeAverage(currentUser, 'hymns');

            document.getElementById('liturgyAvgStudent').textContent = liturgyAvg != null ? liturgyAvg : '--';
            document.getElementById('copticAvgStudent').textContent = copticAvg != null ? copticAvg : '--';
            document.getElementById('hymnsAvgStudent').textContent = hymnsAvg != null ? hymnsAvg : '--';

            // Weekly average
            const validAvgs = [liturgyAvg, copticAvg, hymnsAvg].filter(a => a != null);
            const weeklyAvg = validAvgs.length > 0 ? Math.round(validAvgs.reduce((a, b) => a + b, 0) / validAvgs.length) : 0;
            document.getElementById('studentWeeklyAvg').textContent = weeklyAvg;

            // Term averages
            const term1Grades = ['liturgy', 'coptic', 'hymns'].map(s => currentUser[`${s}_midterm_1`]).filter(g => g != null);
            const term1Avg = term1Grades.length > 0 ? Math.round(term1Grades.reduce((a, b) => a + b, 0) / term1Grades.length) : null;
            document.getElementById('studentTerm1Avg').textContent = term1Avg != null ? term1Avg : '--';

            const term2Grades = ['liturgy', 'coptic', 'hymns'].map(s => currentUser[`${s}_midterm_2`]).filter(g => g != null);
            const term2Avg = term2Grades.length > 0 ? Math.round(term2Grades.reduce((a, b) => a + b, 0) / term2Grades.length) : null;
            document.getElementById('studentTerm2Avg').textContent = term2Avg != null ? term2Avg : '--';
        }

        function updateTeacherDashboard() {
            if (!currentUser) return;

            document.getElementById('teacherWelcome').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø³ØªØ§Ø° ${currentUser.name} ğŸ‘‹`;
            document.getElementById('teacherName').textContent = currentUser.name;
            document.getElementById('teacherPhone').textContent = currentUser.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('teacherCodeDisplay').textContent = currentUser.code;

            try {
                const specializations = JSON.parse(currentUser.specializations || '[]');
                document.getElementById('teacherSpecialization').textContent = specializations.join(', ') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

                const classLevels = JSON.parse(currentUser.class_levels || '[]');
                document.getElementById('teacherClasses').textContent = classLevels.join(', ') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

                const permissions = JSON.parse(currentUser.permissions || '{}');
                
                // Stats
                const allStudents = allUsers.filter(u => u.type === 'student');
                const myStudents = allStudents.filter(s => classLevels.includes(s.class));
                
                document.getElementById('totalStudentsCount').textContent = allStudents.length;
                document.getElementById('myStudentsCount').textContent = myStudents.length;

                // Average attendance rate
                let totalRate = 0;
                myStudents.forEach(s => {
                    const stats = calculateAttendanceStats(s);
                    totalRate += stats.rate;
                });
                const avgRate = myStudents.length > 0 ? Math.round(totalRate / myStudents.length) : 0;
                document.getElementById('avgAttendanceRate').textContent = avgRate + '%';

                // Average class grade
                let totalGrade = 0, gradeCount = 0;
                myStudents.forEach(s => {
                    const liturgyAvg = calculateGradeAverage(s, 'liturgy');
                    const copticAvg = calculateGradeAverage(s, 'coptic');
                    const hymnsAvg = calculateGradeAverage(s, 'hymns');
                    [liturgyAvg, copticAvg, hymnsAvg].forEach(avg => {
                        if (avg != null) {
                            totalGrade += avg;
                            gradeCount++;
                        }
                    });
                });
                const avgGrade = gradeCount > 0 ? Math.round(totalGrade / gradeCount) : 0;
                document.getElementById('avgClassGrade').textContent = avgGrade;

                // Enable/disable buttons based on permissions
                document.getElementById('recordStudentAttendanceBtn').disabled = !permissions.can_record_attendance;
                
                const gradeSubjects = permissions.can_record_grades || [];
                document.getElementById('liturgyGradesBtn').disabled = !gradeSubjects.includes('liturgy');
                document.getElementById('copticGradesBtn').disabled = !gradeSubjects.includes('coptic');
                document.getElementById('hymnsGradesBtn').disabled = !gradeSubjects.includes('hymns');

                document.getElementById('controlTeamCard').style.display = permissions.is_control_team ? 'block' : 'none';

            } catch (e) {
                console.error('Error parsing teacher data:', e);
            }
        }

        function updateDashboard() {
            if (!currentUser) return;
            
            if (currentUser.type === 'student') {
                updateStudentDashboard();
            } else {
                updateTeacherDashboard();
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('studentDashboard').classList.remove('active');
            document.getElementById('teacherDashboard').classList.remove('active');
            document.getElementById('loginForm').reset();
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­. Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‚Ø§Ø¡! ğŸ‘‹');
        }

        function openUploadModal(subject) {
            currentSubject = subject;
            const titles = {
                'liturgy': 'ğŸ“– Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©',
                'coptic': 'ğŸ“ Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©',
                'hymns': 'ğŸµ Ø±ÙØ¹ Ø§Ù„ØªØ³Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù„Ù„Ø£Ù„Ø­Ø§Ù†'
            };
            document.getElementById('uploadModalTitle').textContent = titles[subject];
            document.getElementById('uploadModal').classList.add('active');
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('selectedFileName').textContent = `âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${file.name}`;
            }
        }

        function uploadAssignment() {
            const file = document.getElementById('assignmentFile').files[0];
            if (!file) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }

            showToast('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…...');
            
            setTimeout(() => {
                showToast('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
                closeModal('uploadModal');
                document.getElementById('assignmentFile').value = '';
                document.getElementById('selectedFileName').textContent = '';
            }, 2000);
        }

        function viewResults(examType) {
            if (!currentUser) return;

            const titles = {
                'midterm1': 'Ù†ØªÙŠØ¬Ø© Ù…ÙŠØ¯ØªØ±Ù… Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„',
                'final1': 'Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©',
                'midterm2': 'Ù†ØªÙŠØ¬Ø© Ù…ÙŠØ¯ØªØ±Ù… Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ',
                'final2': 'Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©'
            };

            const fieldMap = {
                'midterm1': 'midterm_1',
                'final1': 'final_1',
                'midterm2': 'midterm_2',
                'final2': 'final_2'
            };

            document.getElementById('resultsTitle').textContent = titles[examType];
            document.getElementById('resultsStudentName').textContent = currentUser.name;
            document.getElementById('resultsStudentCode').textContent = currentUser.code;

            const field = fieldMap[examType];
            const grades = [
                { subject: 'Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©', grade: currentUser[`liturgy_${field}`], max: 100 },
                { subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©', grade: currentUser[`coptic_${field}`], max: 100 },
                { subject: 'Ø§Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„ØªØ³Ø¨Ø­Ø©', grade: currentUser[`hymns_${field}`], max: 100 }
            ];

            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';
            
            let total = 0;
            let maxTotal = 0;
            let validGrades = 0;

            grades.forEach(item => {
                if (item.grade != null && item.grade !== '') {
                    total += parseFloat(item.grade);
                    maxTotal += item.max;
                    validGrades++;
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.subject}</td>
                            <td><strong>${item.grade}</strong></td>
                            <td>${item.max}</td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.subject}</td>
                            <td>--</td>
                            <td>${item.max}</td>
                        </tr>
                    `;
                }
            });

            if (validGrades > 0) {
                tbody.innerHTML += `
                    <tr class="total-row">
                        <td><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</strong></td>
                        <td><strong>${total}</strong></td>
                        <td><strong>${maxTotal}</strong></td>
                    </tr>
                `;
            }

            document.getElementById('resultsModal').classList.add('active');
        }

        function viewAttendanceDetails() {
            if (!currentUser) return;

            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';

            const statusText = {
                'present': 'Ø­Ø§Ø¶Ø±',
                'absent': 'ØºØ§Ø¦Ø¨',
                'excused': 'ØºÙŠØ§Ø¨ Ø¨Ø¥Ø°Ù†'
            };

            const statusClass = {
                'present': 'status-present',
                'absent': 'status-absent',
                'excused': 'status-excused'
            };

            for (let i = 1; i <= 15; i++) {
                const attendance = currentUser[`attendance_week_${i}`];
                if (attendance) {
                    tbody.innerHTML += `
                        <tr>
                            <td>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i}</td>
                            <td>--</td>
                            <td><span class="status-badge ${statusClass[attendance]}">${statusText[attendance]}</span></td>
                        </tr>
                    `;
                }
            }

            if (tbody.innerHTML === '') {
                tbody.innerHTML = '<tr><td colspan="3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¶ÙˆØ± Ù…Ø³Ø¬Ù„Ø©</td></tr>';
            }

            document.getElementById('attendanceModal').classList.add('active');
        }

        function viewTeacherAttendance() {
            showToast('Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø®Ø§Ø¯Ù…');
        }

        function requestAbsence() {
            showToast('ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±');
        }

        function recordStudentAttendance() {
            const classLevels = JSON.parse(currentUser.class_levels || '[]');
            const students = allUsers.filter(u => u.type === 'student' && classLevels.includes(u.class));
            
            const list = document.getElementById('studentAttendanceList');
            list.innerHTML = '';

            const selectedWeek = document.getElementById('attendanceWeek').value;

            students.forEach(student => {
                const currentAttendance = student[`attendance_week_${selectedWeek}`] || 'present';
                
                list.innerHTML += `
                    <div class="attendance-student-card">
                        <h4>${student.name} (${student.code})</h4>
                        <div class="attendance-options">
                            <div class="radio-item">
                                <input type="radio" id="att_${student.code}_present" 
                                       name="attendance_${student.code}" 
                                       value="present" 
                                       ${currentAttendance === 'present' ? 'checked' : ''}>
                                <label for="att_${student.code}_present">Ø­Ø§Ø¶Ø± âœ…</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="att_${student.code}_absent" 
                                       name="attendance_${student.code}" 
                                       value="absent"
                                       ${currentAttendance === 'absent' ? 'checked' : ''}>
                                <label for="att_${student.code}_absent">ØºØ§Ø¦Ø¨ âŒ</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="att_${student.code}_excused" 
                                       name="attendance_${student.code}" 
                                       value="excused"
                                       ${currentAttendance === 'excused' ? 'checked' : ''}>
                                <label for="att_${student.code}_excused">Ø¨Ø¥Ø°Ù† ğŸ“</label>
                            </div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('recordAttendanceModal').classList.add('active');
        }

        async function saveAttendance() {
            const btn = event.target;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸... â³';
            btn.disabled = true;

            const classLevels = JSON.parse(currentUser.class_levels || '[]');
            const students = allUsers.filter(u => u.type === 'student' && classLevels.includes(u.class));
            const selectedWeek = document.getElementById('attendanceWeek').value;

            for (const student of students) {
                const selectedOption = document.querySelector(`input[name="attendance_${student.code}"]:checked`);
                if (selectedOption && window.dataSdk) {
                    const updatedStudent = { ...student };
                    updatedStudent[`attendance_week_${selectedWeek}`] = selectedOption.value;
                    
                    const result = await window.dataSdk.update(updatedStudent);
                    if (!result.isOk) {
                        showToast('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø­Ø¶ÙˆØ± ' + student.name, 'error');
                    }
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }

            showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
            closeModal('recordAttendanceModal');
            btn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±';
            btn.disabled = false;
        }

        function openGradesModal(subject) {
            currentSubject = subject;
            const titles = {
                'liturgy': 'ğŸ“– ØªØ³Ø¬ÙŠÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©',
                'coptic': 'ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©',
                'hymns': 'ğŸµ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØªØ³Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ'
            };

            document.getElementById('gradesModalTitle').textContent = titles[subject];

            const classLevels = JSON.parse(currentUser.class_levels || '[]');
            const students = allUsers.filter(u => u.type === 'student' && classLevels.includes(u.class));
            
            const tbody = document.getElementById('gradesTableBody');
            tbody.innerHTML = '';

            students.forEach(student => {
                tbody.innerHTML += `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.code}</td>
                        <td>${student.class}</td>
                        <td>
                            <input type="number" class="grade-input" 
                                   id="grade_${student.code}" 
                                   min="0" max="100" 
                                   placeholder="0-100"
                                   value="">
                        </td>
                    </tr>
                `;
            });

            document.getElementById('gradesModal').classList.add('active');
        }

        async function saveGrades() {
            const btn = event.target;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸... â³';
            btn.disabled = true;

            const gradeType = document.getElementById('gradeType').value;
            const classLevels = JSON.parse(currentUser.class_levels || '[]');
            const students = allUsers.filter(u => u.type === 'student' && classLevels.includes(u.class));

            for (const student of students) {
                const gradeInput = document.getElementById(`grade_${student.code}`);
                if (gradeInput && gradeInput.value && window.dataSdk) {
                    const grade = parseFloat(gradeInput.value);
                    if (grade >= 0 && grade <= 100) {
                        const updatedStudent = { ...student };
                        updatedStudent[`${currentSubject}_${gradeType}`] = grade;
                        
                        const result = await window.dataSdk.update(updatedStudent);
                        if (!result.isOk) {
                            showToast('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø¯Ø±Ø¬Ø© ' + student.name, 'error');
                        }
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                }
            }

            showToast('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            closeModal('gradesModal');
            btn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª';
            btn.disabled = false;
        }

        function handlePreparationUpload(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('preparationFileName').textContent = `âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${file.name}`;
                showToast('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…...');
                
                setTimeout(() => {
                    showToast('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');
                }, 2000);
            }
        }

        function openAddStudentModal() {
            document.getElementById('addStudentModal').classList.add('active');
        }

        async function addNewStudent(event) {
            event.preventDefault();
            const btn = event.target.querySelector('.action-btn');
            const originalText = btn.textContent;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... â³';
            btn.disabled = true;

            if (allUsers.length >= 999) {
                showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (999)', 'error');
                btn.textContent = originalText;
                btn.disabled = false;
                return;
            }

            const code = generateStudentCode();

            const studentData = {
                type: 'student',
                name: document.getElementById('newStudentName').value,
                code: code,
                class: document.getElementById('newStudentClass').value,
                phone: document.getElementById('newStudentPhone').value,
                parent_phone: document.getElementById('newStudentParentPhone').value,
                enrollment_date: new Date().toISOString().split('T')[0],
                active: true,
                createdAt: new Date().toISOString()
            };

            if (window.dataSdk) {
                const result = await window.dataSdk.create(studentData);
                if (result.isOk) {
                    showToast(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ÙƒÙˆØ¯: ${code}`);
                    closeModal('addStudentModal');
                    event.target.reset();
                } else {
                    showToast('ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³: ' + result.error, 'error');
                }
            }

            btn.textContent = originalText;
            btn.disabled = false;
        }

        function generateStudentCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            const exists = allUsers.some(u => u.code === code);
            if (exists) {
                return generateStudentCode();
            }
            
            return code;
        }

        function manageStudents() {
            const students = allUsers.filter(u => u.type === 'student');
            const container = document.getElementById('studentsListContainer');
            container.innerHTML = '';

            students.forEach(student => {
                const attendanceStats = calculateAttendanceStats(student);
                container.innerHTML += `
                    <div class="student-list-item">
                        <div class="student-info">
                            <h4>${student.name}</h4>
                            <p>ğŸ†” Ø§Ù„ÙƒÙˆØ¯: ${student.code} | ğŸ“š Ø§Ù„ÙØµÙ„: ${student.class}</p>
                            <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${student.phone} | ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${student.parent_phone}</p>
                            <p>âœ… Ø§Ù„Ø­Ø¶ÙˆØ±: ${attendanceStats.rate}%</p>
                        </div>
                        <div class="student-actions">
                            <button class="icon-btn" onclick="editStudent('${student.code}')" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                            <button class="icon-btn" onclick="viewStudentDetails('${student.code}')" title="Ø¹Ø±Ø¶">ğŸ‘ï¸</button>
                        </div>
                    </div>
                `;
            });

            document.getElementById('manageStudentsModal').classList.add('active');
        }

        function filterStudentsList() {
            const selectedClass = document.getElementById('filterClass').value;
            let students = allUsers.filter(u => u.type === 'student');
            
            if (selectedClass !== 'all') {
                students = students.filter(s => s.class === selectedClass);
            }

            const container = document.getElementById('studentsListContainer');
            container.innerHTML = '';

            students.forEach(student => {
                const attendanceStats = calculateAttendanceStats(student);
                container.innerHTML += `
                    <div class="student-list-item">
                        <div class="student-info">
                            <h4>${student.name}</h4>
                            <p>ğŸ†” Ø§Ù„ÙƒÙˆØ¯: ${student.code} | ğŸ“š Ø§Ù„ÙØµÙ„: ${student.class}</p>
                            <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${student.phone} | ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${student.parent_phone}</p>
                            <p>âœ… Ø§Ù„Ø­Ø¶ÙˆØ±: ${attendanceStats.rate}%</p>
                        </div>
                        <div class="student-actions">
                            <button class="icon-btn" onclick="editStudent('${student.code}')" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                            <button class="icon-btn" onclick="viewStudentDetails('${student.code}')" title="Ø¹Ø±Ø¶">ğŸ‘ï¸</button>
                        </div>
                    </div>
                `;
            });
        }

        function editStudent(code) {
            showToast('ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³');
        }

        function viewStudentDetails(code) {
            const student = allUsers.find(u => u.code === code);
            if (student) {
                showToast(`Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ ${student.name}`);
            }
        }

        function manageTeachers() {
            showToast('ÙØªØ­ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ø§Ù…');
        }

        function generateReports() {
            showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø©...');
        }

        function viewDetailedGrades() {
            if (!currentUser) return;

            const content = document.getElementById('detailedGradesContent');
            content.innerHTML = '';

            const subjects = [
                { name: 'Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©', key: 'liturgy', icon: 'ğŸ“–' },
                { name: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©', key: 'coptic', icon: 'ğŸ“' },
                { name: 'Ø§Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„ØªØ³Ø¨Ø­Ø©', key: 'hymns', icon: 'ğŸµ' }
            ];

            subjects.forEach(subject => {
                let html = `
                    <div class="card" style="margin-bottom: 25px;">
                        <h3>${subject.icon} ${subject.name}</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                                    <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                for (let i = 1; i <= 8; i++) {
                    const grade = currentUser[`${subject.key}_weekly_${i}`];
                    if (grade != null && grade !== '') {
                        html += `
                            <tr>
                                <td>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i}</td>
                                <td><strong>${grade}</strong></td>
                            </tr>
                        `;
                    }
                }

                const midterm1 = currentUser[`${subject.key}_midterm_1`];
                if (midterm1 != null && midterm1 !== '') {
                    html += `
                        <tr style="background: #fff3cd;">
                            <td><strong>Ù…ÙŠØ¯ØªØ±Ù… Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„</strong></td>
                            <td><strong>${midterm1}</strong></td>
                        </tr>
                    `;
                }

                const final1 = currentUser[`${subject.key}_final_1`];
                if (final1 != null && final1 !== '') {
                    html += `
                        <tr style="background: #d4edda;">
                            <td><strong>ÙØ§ÙŠÙ†Ø§Ù„ Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„</strong></td>
                            <td><strong>${final1}</strong></td>
                        </tr>
                    `;
                }

                const avg = calculateGradeAverage(currentUser, subject.key);
                if (avg != null) {
                    html += `
                        <tr class="total-row">
                            <td><strong>Ø§Ù„Ù…ØªÙˆØ³Ø·</strong></td>
                            <td><strong>${avg}</strong></td>
                        </tr>
                    `;
                }

                html += `
                            </tbody>
                        </table>
                    </div>
                `;

                content.innerHTML += html;
            });

            document.getElementById('detailedGradesModal').classList.add('active');
        }

        function viewGradesSummary() {
            const classLevels = JSON.parse(currentUser.class_levels || '[]');
            const students = allUsers.filter(u => u.type === 'student' && classLevels.includes(u.class));

            // Calculate subject averages
            const subjectAverages = {
                liturgy: { sum: 0, count: 0 },
                coptic: { sum: 0, count: 0 },
                hymns: { sum: 0, count: 0 }
            };

            students.forEach(student => {
                ['liturgy', 'coptic', 'hymns'].forEach(subject => {
                    const avg = calculateGradeAverage(student, subject);
                    if (avg != null) {
                        subjectAverages[subject].sum += avg;
                        subjectAverages[subject].count++;
                    }
                });
            });

            // Create chart
            const chartContainer = document.getElementById('subjectAverageChart');
            chartContainer.innerHTML = '';

            const subjects = [
                { name: 'Ø§Ù„Ø·Ù‚ÙˆØ³', key: 'liturgy' },
                { name: 'Ø§Ù„Ù‚Ø¨Ø·ÙŠ', key: 'coptic' },
                { name: 'Ø§Ù„Ø£Ù„Ø­Ø§Ù†', key: 'hymns' }
            ];

            subjects.forEach(subject => {
                const data = subjectAverages[subject.key];
                const avg = data.count > 0 ? Math.round(data.sum / data.count) : 0;
                const height = (avg / 100) * 100;

                chartContainer.innerHTML += `
                    <div class="bar" style="height: ${height}%;">
                        <span class="bar-value">${avg}</span>
                        <span class="bar-label">${subject.name}</span>
                    </div>
                `;
            });

            // Create detailed table
            const content = document.getElementById('gradesSummaryContent');
            content.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                            <th>Ø§Ù„ÙØµÙ„</th>
                            <th>Ø§Ù„Ø·Ù‚ÙˆØ³</th>
                            <th>Ø§Ù„Ù‚Ø¨Ø·ÙŠ</th>
                            <th>Ø§Ù„Ø£Ù„Ø­Ø§Ù†</th>
                            <th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            students.forEach(student => {
                const liturgyAvg = calculateGradeAverage(student, 'liturgy');
                const copticAvg = calculateGradeAverage(student, 'coptic');
                const hymnsAvg = calculateGradeAverage(student, 'hymns');

                const validAvgs = [liturgyAvg, copticAvg, hymnsAvg].filter(a => a != null);
                const overallAvg = validAvgs.length > 0 ? Math.round(validAvgs.reduce((a, b) => a + b, 0) / validAvgs.length) : null;

                content.innerHTML += `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.class}</td>
                        <td>${liturgyAvg != null ? liturgyAvg : '--'}</td>
                        <td>${copticAvg != null ? copticAvg : '--'}</td>
                        <td>${hymnsAvg != null ? hymnsAvg : '--'}</td>
                        <td><strong>${overallAvg != null ? overallAvg : '--'}</strong></td>
                    </tr>
                `;
            });

            content.innerHTML += `
                    </tbody>
                </table>
            `;

            document.getElementById('gradesSummaryModal').classList.add('active');
        }

        function viewAttendanceReports() {
            const classLevels = JSON.parse(currentUser.class_levels || '[]');
            const students = allUsers.filter(u => u.type === 'student' && classLevels.includes(u.class));

            let totalPresent = 0, totalAbsent = 0, totalExcused = 0, totalRecords = 0;

            students.forEach(student => {
                const stats = calculateAttendanceStats(student);
                totalPresent += stats.present;
                totalAbsent += stats.absent;
                totalExcused += stats.excused;
                totalRecords += (stats.present + stats.absent + stats.excused);
            });

            const avgAttendance = totalRecords > 0 ? Math.round((totalPresent / totalRecords) * 100) : 0;

            document.getElementById('reportTotalStudents').textContent = students.length;
            document.getElementById('reportAvgAttendance').textContent = avgAttendance + '%';
            document.getElementById('reportTotalPresent').textContent = totalPresent;
            document.getElementById('reportTotalAbsent').textContent = totalAbsent;

            // Class-based attendance chart
            const classes = [...new Set(students.map(s => s.class))];
            const chartContainer = document.getElementById('classAttendanceChart');
            chartContainer.innerHTML = '';

            classes.forEach(className => {
                const classStudents = students.filter(s => s.class === className);
                let classPresent = 0, classTotal = 0;

                classStudents.forEach(student => {
                    const stats = calculateAttendanceStats(student);
                    classPresent += stats.present;
                    classTotal += (stats.present + stats.absent + stats.excused);
                });

                const classRate = classTotal > 0 ? Math.round((classPresent / classTotal) * 100) : 0;
                const height = classRate;

                chartContainer.innerHTML += `
                    <div class="bar" style="height: ${height}%;">
                        <span class="bar-value">${classRate}%</span>
                        <span class="bar-label">${className}</span>
                    </div>
                `;
            });

            // Detailed table
            const content = document.getElementById('attendanceReportsContent');
            content.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                            <th>Ø§Ù„ÙØµÙ„</th>
                            <th>Ø­Ø§Ø¶Ø±</th>
                            <th>ØºØ§Ø¦Ø¨</th>
                            <th>Ø¨Ø¥Ø°Ù†</th>
                            <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            students.forEach(student => {
                const stats = calculateAttendanceStats(student);
                content.innerHTML += `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.class}</td>
                        <td>${stats.present}</td>
                        <td>${stats.absent}</td>
                        <td>${stats.excused}</td>
                        <td><strong>${stats.rate}%</strong></td>
                    </tr>
                `;
            });

            content.innerHTML += `
                    </tbody>
                </table>
            `;

            document.getElementById('attendanceReportsModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        initApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a0ecc28d20970ec',t:'MTc2MzU0NTc2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
