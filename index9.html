<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }
        
        * {
            box-sizing: border-box;
        }

        .toast {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .btn-primary {
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: scale(1.05);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .loading {
            pointer-events: none;
            opacity: 0.6;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal-overlay {
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            ring: 2px;
            ring-color: rgb(180, 83, 9);
        }

        .week-card {
            transition: all 0.2s ease;
        }

        .week-card:hover {
            background-color: rgb(254, 243, 199);
        }

        .stat-card {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
        }

        .drag-over {
            border-color: rgb(180, 83, 9);
            background-color: rgb(254, 243, 199);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full">
  <div id="app" class="min-h-full"></div><!-- Toast Container -->
  <div id="toast-container" class="fixed top-5 left-5 z-50 space-y-2"></div>
  <script>
        // =====================================================
        // CONFIGURATION & STATE
        // =====================================================
        
        const defaultConfig = {
            center_name: 'Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù†',
            center_subtitle: 'ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©',
            welcome_message: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ',
            footer_text: 'ØµÙÙ†Ø¹ Ø¨Ø­Ø¨ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ÙƒÙ†ÙŠØ³Ø©',
            background_color: '#F5F5DC',
            surface_color: '#FFFFFF',
            text_color: '#2C1810',
            primary_action_color: '#8B4513',
            secondary_action_color: '#A0522D',
            font_family: 'Cairo',
            font_size: 16
        };

        let currentUser = null;
        let allRecords = [];
        let googleConfig = {
            scriptUrl: '',
            driveFolderId: ''
        };

        const TOTAL_WEEKS = 15;
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'admin123';

        // =====================================================
        // DATA SDK INITIALIZATION
        // =====================================================

        const dataHandler = {
            onDataChanged(data) {
                allRecords = data;
                console.log('Data updated:', data.length, 'records');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                if (currentUser) {
                    if (currentUser.type === 'admin') {
                        renderAdminDashboard();
                    } else if (currentUser.type === 'teacher') {
                        renderTeacherDashboard();
                    } else if (currentUser.type === 'student') {
                        renderStudentDashboard();
                    }
                }
            }
        };

        async function initializeApp() {
            const result = await window.dataSdk.init(dataHandler);
            if (!result.isOk) {
                console.error('Failed to initialize Data SDK');
                showToast('ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
                return;
            }

            // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Ù…Ù† localStorage
            const savedGoogle = localStorage.getItem('googleConfig');
            if (savedGoogle) {
                googleConfig = JSON.parse(savedGoogle);
            }

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            const savedSession = localStorage.getItem('currentUser');
            if (savedSession) {
                currentUser = JSON.parse(savedSession);
                if (currentUser.type === 'admin') {
                    renderAdminDashboard();
                } else if (currentUser.type === 'teacher') {
                    renderTeacherDashboard();
                } else if (currentUser.type === 'student') {
                    renderStudentDashboard();
                }
            } else {
                renderLoginPage();
            }
        }

        // =====================================================
        // ELEMENT SDK INITIALIZATION
        // =====================================================

        async function onConfigChange(config) {
            document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
            
            const elements = document.querySelectorAll('.dynamic-text');
            elements.forEach(el => {
                el.style.color = config.text_color || defaultConfig.text_color;
            });

            const surfaces = document.querySelectorAll('.dynamic-surface');
            surfaces.forEach(el => {
                el.style.backgroundColor = config.surface_color || defaultConfig.surface_color;
            });

            const primaryButtons = document.querySelectorAll('.dynamic-primary-btn');
            primaryButtons.forEach(el => {
                el.style.backgroundColor = config.primary_action_color || defaultConfig.primary_action_color;
            });

            const secondaryButtons = document.querySelectorAll('.dynamic-secondary-btn');
            secondaryButtons.forEach(el => {
                el.style.backgroundColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            });

            const baseFont = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            document.body.style.fontFamily = `${customFont}, Cairo, sans-serif`;
            document.body.style.fontSize = `${baseFont}px`;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
            const centerNameElements = document.querySelectorAll('.center-name');
            centerNameElements.forEach(el => {
                el.textContent = config.center_name || defaultConfig.center_name;
            });

            const centerSubtitleElements = document.querySelectorAll('.center-subtitle');
            centerSubtitleElements.forEach(el => {
                el.textContent = config.center_subtitle || defaultConfig.center_subtitle;
            });

            const welcomeElements = document.querySelectorAll('.welcome-message');
            welcomeElements.forEach(el => {
                el.textContent = config.welcome_message || defaultConfig.welcome_message;
            });

            const footerElements = document.querySelectorAll('.footer-text');
            footerElements.forEach(el => {
                el.textContent = config.footer_text || defaultConfig.footer_text;
            });
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                window.elementSdk.config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        },
                        {
                            get: () => config.surface_color || defaultConfig.surface_color,
                            set: (value) => {
                                window.elementSdk.config.surface_color = value;
                                window.elementSdk.setConfig({ surface_color: value });
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                window.elementSdk.config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        },
                        {
                            get: () => config.primary_action_color || defaultConfig.primary_action_color,
                            set: (value) => {
                                window.elementSdk.config.primary_action_color = value;
                                window.elementSdk.setConfig({ primary_action_color: value });
                            }
                        },
                        {
                            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                            set: (value) => {
                                window.elementSdk.config.secondary_action_color = value;
                                window.elementSdk.setConfig({ secondary_action_color: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: {
                        get: () => config.font_family || defaultConfig.font_family,
                        set: (value) => {
                            window.elementSdk.config.font_family = value;
                            window.elementSdk.setConfig({ font_family: value });
                        }
                    },
                    fontSizeable: {
                        get: () => config.font_size || defaultConfig.font_size,
                        set: (value) => {
                            window.elementSdk.config.font_size = value;
                            window.elementSdk.setConfig({ font_size: value });
                        }
                    }
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["center_name", config.center_name || defaultConfig.center_name],
                    ["center_subtitle", config.center_subtitle || defaultConfig.center_subtitle],
                    ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
                    ["footer_text", config.footer_text || defaultConfig.footer_text]
                ])
            });
        }

        // =====================================================
        // UTILITY FUNCTIONS
        // =====================================================

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            const icon = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹';
            
            toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2`;
            toast.innerHTML = `<span class="text-xl">${icon}</span><span>${message}</span>`;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function generateCode(prefix) {
            if (prefix === 'ST') {
                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¨Ù†Ù…Ø· DQ34ZA54 Ù„Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 8; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            } else {
                // Ù„Ù„Ø®Ø¯Ø§Ù…: T + timestamp + random
                const timestamp = Date.now().toString().slice(-6);
                const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                return `${prefix}${timestamp}${random}`;
            }
        }

        function getRecordsByType(type) {
            return allRecords.filter(r => r.type === type);
        }

        function getRecordByCode(code) {
            return allRecords.find(r => r.code === code);
        }

        function getStudentsByTeacher(teacherId) {
            return allRecords.filter(r => r.type === 'student' && r.teacher_id === teacherId);
        }

        function getAttendanceRecords(studentCode) {
            return allRecords.filter(r => 
                r.type === 'attendance' && 
                r.code === studentCode
            ).sort((a, b) => a.week_number - b.week_number);
        }

        function getHomeworkRecords(studentCode) {
            return allRecords.filter(r => 
                r.type === 'homework' && 
                r.code === studentCode
            ).sort((a, b) => a.week_number - b.week_number);
        }

        function calculateStats(studentCode) {
            const attendance = getAttendanceRecords(studentCode);
            const homework = getHomeworkRecords(studentCode);
            
            const presentDays = attendance.filter(a => a.present).length;
            const submittedHomework = homework.filter(h => h.homework_status !== 'pending').length;
            const gradedHomework = homework.filter(h => h.grade !== null && h.grade !== undefined);
            
            const totalGrades = gradedHomework.reduce((sum, h) => sum + (h.grade || 0), 0);
            const average = gradedHomework.length > 0 ? Math.round(totalGrades / gradedHomework.length) : 0;
            
            return {
                presentDays,
                submittedHomework,
                totalGrades,
                average,
                attendancePercentage: Math.round((presentDays / TOTAL_WEEKS) * 100)
            };
        }

        // =====================================================
        // GOOGLE INTEGRATION
        // =====================================================

        async function testGoogleConnection() {
            if (!googleConfig.scriptUrl) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Google Script Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return false;
            }

            showToast('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');

            try {
                const response = await fetch(googleConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'test', data: {} })
                });

                // Ø¨Ø³Ø¨Ø¨ no-cors Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©ØŒ Ù„ÙƒÙ† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø£ ÙŠØ¹Ù†ÙŠ Ø§Ù„Ù†Ø¬Ø§Ø­
                showToast('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! âœ“', 'success');
                return true;
            } catch (error) {
                showToast('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Script', 'error');
                return false;
            }
        }

        async function syncToGoogle(record) {
            if (!googleConfig.scriptUrl || record.synced_to_google) {
                return;
            }

            try {
                let action = '';
                if (record.type === 'student') action = 'addStudent';
                else if (record.type === 'teacher') action = 'addTeacher';
                else if (record.type === 'attendance') action = 'saveAttendance';
                else if (record.type === 'homework') action = 'saveHomework';
                else return;

                await fetch(googleConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action, data: record })
                });

                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                const updateResult = await window.dataSdk.update({
                    ...record,
                    synced_to_google: true
                });

                if (updateResult.isOk) {
                    console.log('Synced to Google:', record.id);
                }
            } catch (error) {
                console.error('Google sync error:', error);
            }
        }

        async function uploadFileToDrive(fileData, filename, studentCode, week) {
            if (!googleConfig.scriptUrl || !googleConfig.driveFolderId) {
                showToast('Ù„Ù… ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Google Drive', 'error');
                return null;
            }

            try {
                const response = await fetch(googleConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'uploadFile',
                        data: {
                            fileData,
                            filename,
                            studentCode,
                            week,
                            folderId: googleConfig.driveFolderId
                        }
                    })
                });

                // Ø¨Ø³Ø¨Ø¨ no-corsØŒ Ù†ÙØªØ±Ø¶ Ø§Ù„Ù†Ø¬Ø§Ø­
                const driveUrl = `https://drive.google.com/drive/folders/${googleConfig.driveFolderId}`;
                return driveUrl;
            } catch (error) {
                console.error('Drive upload error:', error);
                return null;
            }
        }

        // =====================================================
        // LOGIN PAGE
        // =====================================================

        function renderLoginPage() {
            const config = window.elementSdk?.config || defaultConfig;
            
            document.getElementById('app').innerHTML = `
                <main class="min-h-full flex items-center justify-center p-4">
                    <div class="dynamic-surface w-full max-w-md p-8 rounded-2xl shadow-2xl fade-in">
                        <div class="text-center mb-8">
                            <div class="text-6xl mb-4">âœï¸</div>
                            <h1 class="center-name dynamic-text text-3xl font-bold mb-2">${config.center_name || defaultConfig.center_name}</h1>
                            <p class="center-subtitle dynamic-text text-lg opacity-80">${config.center_subtitle || defaultConfig.center_subtitle}</p>
                        </div>

                        <div class="mb-6">
                            <div class="flex gap-2 p-1 bg-amber-100 rounded-lg">
                                <button type="button" onclick="switchLoginType('student')" id="btn-student" class="flex-1 py-2 px-4 rounded-lg font-semibold dynamic-primary-btn text-white">
                                    ğŸ‘¦ Ø¯Ø§Ø±Ø³
                                </button>
                                <button type="button" onclick="switchLoginType('teacher')" id="btn-teacher" class="flex-1 py-2 px-4 rounded-lg font-semibold bg-transparent dynamic-text">
                                    ğŸ“ Ø®Ø§Ø¯Ù…
                                </button>
                                <button type="button" onclick="switchLoginType('admin')" id="btn-admin" class="flex-1 py-2 px-4 rounded-lg font-semibold bg-transparent dynamic-text">
                                    ğŸ› ï¸ Ù…Ø³Ø¤ÙˆÙ„
                                </button>
                            </div>
                        </div>

                        <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
                            <div id="student-form">
                                <label for="student-code" class="block dynamic-text font-semibold mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³</label>
                                <input type="text" id="student-code" required
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                    placeholder="Ù…Ø«Ø§Ù„: ST123456">
                            </div>

                            <div id="teacher-form" class="hidden space-y-4">
                                <div>
                                    <label for="teacher-code" class="block dynamic-text font-semibold mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…</label>
                                    <input type="text" id="teacher-code"
                                        class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                        placeholder="Ù…Ø«Ø§Ù„: T123456">
                                </div>
                                <div>
                                    <label for="teacher-password" class="block dynamic-text font-semibold mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                    <input type="password" id="teacher-password"
                                        class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                                </div>
                            </div>

                            <div id="admin-form" class="hidden space-y-4">
                                <div>
                                    <label for="admin-username" class="block dynamic-text font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                    <input type="text" id="admin-username"
                                        class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                        placeholder="admin">
                                </div>
                                <div>
                                    <label for="admin-password" class="block dynamic-text font-semibold mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                    <input type="password" id="admin-password"
                                        class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                                </div>
                            </div>

                            <button type="submit" class="w-full dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold text-lg btn-primary">
                                ğŸ” Ø¯Ø®ÙˆÙ„
                            </button>
                        </form>

                        <div class="mt-6 text-center">
                            <p class="footer-text dynamic-text text-sm opacity-60">${config.footer_text || defaultConfig.footer_text}</p>
                        </div>
                    </div>
                </main>
            `;
        }

        function switchLoginType(type) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
            document.getElementById('student-form').classList.add('hidden');
            document.getElementById('teacher-form').classList.add('hidden');
            document.getElementById('admin-form').classList.add('hidden');
            
            // Ø¥Ø²Ø§Ù„Ø© required Ù…Ù† Ø¬Ù…ÙŠØ¹ ï¿½ï¿½ï¿½ï¿½Ù„Ø­Ù‚ÙˆÙ„
            const studentCode = document.getElementById('student-code');
            const teacherCode = document.getElementById('teacher-code');
            const teacherPassword = document.getElementById('teacher-password');
            const adminUsername = document.getElementById('admin-username');
            const adminPassword = document.getElementById('admin-password');
            
            studentCode.required = false;
            teacherCode.required = false;
            teacherPassword.required = false;
            adminUsername.required = false;
            adminPassword.required = false;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.getElementById('btn-student').classList.remove('dynamic-primary-btn', 'text-white');
            document.getElementById('btn-teacher').classList.remove('dynamic-primary-btn', 'text-white');
            document.getElementById('btn-admin').classList.remove('dynamic-primary-btn', 'text-white');
            
            document.getElementById('btn-student').classList.add('bg-transparent', 'dynamic-text');
            document.getElementById('btn-teacher').classList.add('bg-transparent', 'dynamic-text');
            document.getElementById('btn-admin').classList.add('bg-transparent', 'dynamic-text');

            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            if (type === 'student') {
                document.getElementById('student-form').classList.remove('hidden');
                document.getElementById('btn-student').classList.remove('bg-transparent', 'dynamic-text');
                document.getElementById('btn-student').classList.add('dynamic-primary-btn', 'text-white');
                studentCode.required = true;
            } else if (type === 'teacher') {
                document.getElementById('teacher-form').classList.remove('hidden');
                document.getElementById('btn-teacher').classList.remove('bg-transparent', 'dynamic-text');
                document.getElementById('btn-teacher').classList.add('dynamic-primary-btn', 'text-white');
                teacherCode.required = true;
                teacherPassword.required = true;
            } else if (type === 'admin') {
                document.getElementById('admin-form').classList.remove('hidden');
                document.getElementById('btn-admin').classList.remove('bg-transparent', 'dynamic-text');
                document.getElementById('btn-admin').classList.add('dynamic-primary-btn', 'text-white');
                adminUsername.required = true;
                adminPassword.required = true;
            }
        }

        async function handleLogin(event) {
            event.preventDefault();

            const studentCode = document.getElementById('student-code').value;
            const teacherCode = document.getElementById('teacher-code').value;
            const teacherPassword = document.getElementById('teacher-password').value;
            const adminUsername = document.getElementById('admin-username').value;
            const adminPassword = document.getElementById('admin-password').value;

            if (studentCode && !document.getElementById('student-form').classList.contains('hidden')) {
                const student = getRecordByCode(studentCode);
                if (student && student.type === 'student') {
                    currentUser = student;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    renderStudentDashboard();
                } else {
                    showToast('ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                }
            } else if (teacherCode && teacherPassword && !document.getElementById('teacher-form').classList.contains('hidden')) {
                const teacher = getRecordByCode(teacherCode);
                if (teacher && teacher.type === 'teacher' && teacher.password === teacherPassword) {
                    currentUser = teacher;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    renderTeacherDashboard();
                } else {
                    showToast('ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
            } else if (adminUsername && adminPassword && !document.getElementById('admin-form').classList.contains('hidden')) {
                if (adminUsername === ADMIN_USERNAME && adminPassword === ADMIN_PASSWORD) {
                    currentUser = { type: 'admin', name: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„' };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    renderAdminDashboard();
                } else {
                    showToast('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            renderLoginPage();
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // =====================================================
        // STUDENT DASHBOARD
        // =====================================================

        function renderStudentDashboard() {
            const config = window.elementSdk?.config || defaultConfig;
            const stats = calculateStats(currentUser.code);
            const attendance = getAttendanceRecords(currentUser.code);
            const homework = getHomeworkRecords(currentUser.code);

            document.getElementById('app').innerHTML = `
                <div class="min-h-full p-4">
                    <header class="dynamic-surface rounded-2xl shadow-lg p-6 mb-6 fade-in">
                        <div class="flex justify-between items-center">
                            <div>
                                <h1 class="welcome-message dynamic-text text-2xl font-bold">${config.welcome_message || defaultConfig.welcome_message}</h1>
                                <p class="dynamic-text text-3xl font-bold mt-2">ğŸ‘¦ ${currentUser.name}</p>
                                <p class="dynamic-text opacity-60 mt-1">ÙƒÙˆØ¯: ${currentUser.code}</p>
                            </div>
                            <button onclick="logout()" class="dynamic-secondary-btn text-white px-6 py-2 rounded-lg font-semibold btn-primary">
                                ğŸšª Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </header>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 slide-up">
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ğŸ“…</div>
                            <div class="text-3xl font-bold">${stats.presentDays}</div>
                            <div class="text-sm opacity-90">Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ğŸ“</div>
                            <div class="text-3xl font-bold">${stats.submittedHomework}</div>
                            <div class="text-sm opacity-90">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…Ø³Ù„Ù…Ø©</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">â­</div>
                            <div class="text-3xl font-bold">${stats.totalGrades}</div>
                            <div class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ğŸ“Š</div>
                            <div class="text-3xl font-bold">${stats.average}</div>
                            <div class="text-sm opacity-90">Ø§Ù„Ù…ØªÙˆØ³Ø·</div>
                        </div>
                    </div>

                    <div class="dynamic-surface rounded-2xl shadow-lg p-6 mb-6 slide-up">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="dynamic-text text-2xl font-bold">ğŸ“š Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</h2>
                            <button onclick="showUploadHomework()" class="dynamic-primary-btn text-white px-6 py-2 rounded-lg font-semibold btn-primary">
                                ğŸ“¤ Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨
                            </button>
                        </div>
                        <div class="space-y-3" id="weeks-list">
                            ${renderWeeksList(attendance, homework)}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderWeeksList(attendance, homework) {
            let html = '';
            for (let week = 1; week <= TOTAL_WEEKS; week++) {
                const att = attendance.find(a => a.week_number === week);
                const hw = homework.find(h => h.week_number === week);
                
                const present = att?.present ? 'âœ… Ø­Ø§Ø¶Ø±' : 'âŒ ØºØ§Ø¦Ø¨';
                const hwStatus = hw ? 
                    hw.homework_status === 'graded' ? `â­ ${hw.grade}/100` :
                    hw.homework_status === 'submitted' ? 'ğŸ“ Øªï¿½ï¿½ Ø§Ù„ØªØ³Ù„ÙŠÙ…' :
                    'â³ Ù…Ø¹Ù„Ù‚' : 'â³ Ù…Ø¹ï¿½ï¿½Ù‚';
                
                const notes = hw?.notes ? `<p class="text-sm opacity-75 mt-1">ğŸ’¬ ${hw.notes}</p>` : '';
                
                html += `
                    <div class="week-card border-2 border-amber-200 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="dynamic-text font-bold text-lg">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${week}</h3>
                                <div class="flex gap-4 mt-2">
                                    <span class="text-sm">${present}</span>
                                    <span class="text-sm">${hwStatus}</span>
                                </div>
                                ${notes}
                            </div>
                            ${hw?.drive_url ? `<a href="${hw.drive_url}" target="_blank" rel="noopener noreferrer" class="dynamic-secondary-btn text-white px-4 py-2 rounded-lg text-sm">ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</a>` : ''}
                        </div>
                    </div>
                `;
            }
            return html;
        }

        function showUploadHomework() {
            const config = window.elementSdk?.config || defaultConfig;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-lg w-full">
                    <h2 class="dynamic-text text-2xl font-bold mb-4">ğŸ“¤ Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                    <form id="upload-form" onsubmit="handleUploadHomework(event)" class="space-y-4">
                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                            <select id="week-select" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                ${Array.from({length: TOTAL_WEEKS}, (_, i) => `<option value="${i+1}">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i+1}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ù†Øµ Ø§Ù„ÙˆØ§Ø¬Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <textarea id="homework-text" rows="4" class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ù‡Ù†Ø§..."></textarea>
                        </div>
                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø±ÙØ¹ Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <div id="drop-zone" class="border-2 border-dashed border-amber-300 rounded-lg p-8 text-center cursor-pointer hover:bg-amber-50">
                                <div class="text-4xl mb-2">ğŸ“</div>
                                <p class="dynamic-text">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                                <p class="text-sm opacity-60 mt-2">PDF, Word, Audio (MP3, M4A, WAV)</p>
                                <input type="file" id="file-input" class="hidden" accept=".pdf,.doc,.docx,.mp3,.m4a,.wav">
                            </div>
                            <p id="file-name" class="text-sm mt-2 dynamic-text"></p>
                        </div>
                        <div class="flex gap-3">
                            <button type="submit" class="flex-1 dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨
                            </button>
                            <button type="button" onclick="this.closest('.modal-overlay').remove()" class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Setup drag and drop
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            
            dropZone.onclick = () => fileInput.click();
            
            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            };
            
            dropZone.ondragleave = () => {
                dropZone.classList.remove('drag-over');
            };
            
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    document.getElementById('file-name').textContent = `ğŸ“ ${files[0].name}`;
                }
            };
            
            fileInput.onchange = (e) => {
                if (e.target.files.length > 0) {
                    document.getElementById('file-name').textContent = `ğŸ“ ${e.target.files[0].name}`;
                }
            };
        }

        async function handleUploadHomework(event) {
            event.preventDefault();
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<span class="spinner"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';

            const week = parseInt(document.getElementById('week-select').value);
            const text = document.getElementById('homework-text').value;
            const fileInput = document.getElementById('file-input');
            
            let driveUrl = null;
            let fileName = null;
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName = file.name;
                
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Base64
                const reader = new FileReader();
                const fileData = await new Promise((resolve) => {
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.readAsDataURL(file);
                });
                
                // Ø±ÙØ¹ Ø¥Ù„Ù‰ Drive Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹
                if (googleConfig.scriptUrl && googleConfig.driveFolderId) {
                    driveUrl = await uploadFileToDrive(fileData, fileName, currentUser.code, week);
                }
            }

            // Ø­ÙØ¸ Ø§Ù„ÙˆØ§Ø¬Ø¨
            const homeworkId = `hw_${currentUser.code}_${week}`;
            const existingHomework = allRecords.find(r => r.id === homeworkId);

            const homeworkData = {
                id: homeworkId,
                type: 'homework',
                code: currentUser.code,
                week_number: week,
                homework_text: text,
                homework_file: fileName,
                homework_status: 'submitted',
                drive_url: driveUrl,
                grade: null,
                notes: '',
                synced_to_google: false,
                created_at: new Date().toISOString()
            };

            let result;
            if (existingHomework) {
                result = await window.dataSdk.update({
                    ...existingHomework,
                    ...homeworkData
                });
            } else {
                result = await window.dataSdk.create(homeworkData);
            }

            if (result.isOk) {
                showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ù†Ø¬Ø§Ø­! âœ“', 'success');
                document.querySelector('.modal-overlay').remove();
                
                // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Google
                if (googleConfig.scriptUrl) {
                    syncToGoogle(homeworkData);
                }
            } else {
                showToast('ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨', 'error');
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ùˆï¿½ï¿½Ø¬Ø¨';
            }
        }

        // =====================================================
        // TEACHER DASHBOARD
        // =====================================================

        function renderTeacherDashboard() {
            const config = window.elementSdk?.config || defaultConfig;
            const myStudents = getStudentsByTeacher(currentUser.id);
            const presentToday = myStudents.filter(s => {
                const lastWeek = getAttendanceRecords(s.code).pop();
                return lastWeek?.present;
            }).length;
            const pendingHomework = allRecords.filter(r => 
                r.type === 'homework' && 
                r.homework_status === 'submitted' &&
                myStudents.some(s => s.code === r.code)
            ).length;

            document.getElementById('app').innerHTML = `
                <div class="min-h-full p-4">
                    <header class="dynamic-surface rounded-2xl shadow-lg p-6 mb-6 fade-in">
                        <div class="flex justify-between items-center flex-wrap gap-4">
                            <div>
                                <h1 class="dynamic-text text-2xl font-bold">ğŸ“ Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h1>
                                <p class="dynamic-text text-3xl font-bold mt-2">${currentUser.name}</p>
                                <p class="dynamic-text opacity-60 mt-1">ÙƒÙˆØ¯: ${currentUser.code}</p>
                            </div>
                            <button onclick="logout()" class="dynamic-secondary-btn text-white px-6 py-2 rounded-lg font-semibold btn-primary">
                                ğŸšª Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 slide-up">
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ï¿½ï¿½</div>
                            <div class="text-3xl font-bold">${myStudents.length}</div>
                            <div class="text-sm opacity-90">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">âœ…</div>
                            <div class="text-3xl font-bold">${presentToday}</div>
                            <div class="text-sm opacity-90">Ø§Ù„Ø­Ø§Ø¶Ø±ÙˆÙ†</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">â³</div>
                            <div class="text-3xl font-bold">${pendingHomework}</div>
                            <div class="text-sm opacity-90">ÙˆØ§Ø¬Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 mb-6 slide-up">
                        <button onclick="showAttendanceForm()" class="dynamic-surface p-8 rounded-2xl shadow-lg hover:shadow-xl card-hover">
                            <div class="text-5xl mb-3">ğŸ“‹</div>
                            <h3 class="dynamic-text text-2xl font-bold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                            <p class="dynamic-text opacity-60 mt-2">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</p>
                        </button>
                        <button onclick="showGradingForm()" class="dynamic-surface p-8 rounded-2xl shadow-lg hover:shadow-xl card-hover">
                            <div class="text-5xl mb-3">â­</div>
                            <h3 class="dynamic-text text-2xl font-bold">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h3>
                            <p class="dynamic-text opacity-60 mt-2">ØªÙ‚ÙŠÙŠÙ… ÙˆÙˆØ¶Ø¹ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</p>
                        </button>
                    </div>

                    <div class="dynamic-surface rounded-2xl shadow-lg p-6 slide-up">
                        <h2 class="dynamic-text text-2xl font-bold mb-4">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h2>
                        <div class="space-y-3">
                            ${myStudents.map(student => {
                                const stats = calculateStats(student.code);
                                return `
                                    <div class="border-2 border-amber-200 rounded-lg p-4">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <h3 class="dynamic-text font-bold text-lg">${student.name}</h3>
                                                <p class="text-sm opacity-75">ÙƒÙˆØ¯: ${student.code} | Ø§Ù„ÙØµÙ„: ${student.class_name}</p>
                                                <div class="flex gap-4 mt-2 text-sm">
                                                    <span>ğŸ“… ${stats.presentDays} ÙŠÙˆÙ… Ø­Ø¶ÙˆØ±</span>
                                                    <span>ğŸ“ ${stats.submittedHomework} ÙˆØ§Ø¬Ø¨</span>
                                                    <span>â­ Ù…ØªÙˆØ³Ø·: ${stats.average}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function showAttendanceForm() {
            const myStudents = getStudentsByTeacher(currentUser.id);
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-2xl w-full max-h-[90%] overflow-y-auto">
                    <h2 class="dynamic-text text-2xl font-bold mb-4">ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
                    <form id="attendance-form" onsubmit="handleAttendance(event)" class="space-y-4">
                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                            <select id="att-week-select" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                ${Array.from({length: TOTAL_WEEKS}, (_, i) => `<option value="${i+1}">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i+1}</option>`).join('')}
                            </select>
                        </div>
                        <div class="space-y-2">
                            ${myStudents.map(student => `
                                <div class="flex items-center gap-3 p-3 border-2 border-amber-200 rounded-lg">
                                    <input type="checkbox" id="att-${student.code}" value="${student.code}" 
                                        class="w-5 h-5 rounded">
                                    <label for="att-${student.code}" class="flex-1 dynamic-text font-semibold">
                                        ${student.name} (${student.code})
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex gap-3">
                            <button type="submit" class="flex-1 dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±
                            </button>
                            <button type="button" onclick="this.closest('.modal-overlay').remove()" class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        async function handleAttendance(event) {
            event.preventDefault();
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<span class="spinner"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

            const week = parseInt(document.getElementById('att-week-select').value);
            const myStudents = getStudentsByTeacher(currentUser.id);
            
            let successCount = 0;
            
            for (const student of myStudents) {
                const checkbox = document.getElementById(`att-${student.code}`);
                const present = checkbox.checked;
                
                const attId = `att_${student.code}_${week}`;
                const existing = allRecords.find(r => r.id === attId);
                
                const attData = {
                    id: attId,
                    type: 'attendance',
                    code: student.code,
                    week_number: week,
                    present: present,
                    synced_to_google: false,
                    created_at: new Date().toISOString()
                };
                
                let result;
                if (existing) {
                    result = await window.dataSdk.update({
                        ...existing,
                        ...attData
                    });
                } else {
                    result = await window.dataSdk.create(attData);
                }
                
                if (result.isOk) {
                    successCount++;
                    if (googleConfig.scriptUrl) {
                        syncToGoogle(attData);
                    }
                }
            }
            
            if (successCount > 0) {
                showToast(`ØªÙ… Ø­ÙØ¸ Ø­Ø¶ÙˆØ± ${successCount} Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­! âœ“`, 'success');
                document.querySelector('.modal-overlay').remove();
            } else {
                showToast('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±', 'error');
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±';
            }
        }

        function showGradingForm() {
            const myStudents = getStudentsByTeacher(currentUser.id);
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-4xl w-full max-h-[90%] overflow-y-auto">
                    <h2 class="dynamic-text text-2xl font-bold mb-4">â­ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h2>
                    <div class="mb-4">
                        <label class="block dynamic-text font-semibold mb-2">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                        <select id="grade-week-select" onchange="loadHomeworkForWeek()" class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                            ${Array.from({length: TOTAL_WEEKS}, (_, i) => `<option value="${i+1}">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i+1}</option>`).join('')}
                        </select>
                    </div>
                    <div id="homework-list" class="space-y-4"></div>
                    <div class="mt-4 flex gap-3">
                        <button onclick="saveAllGrades()" class="flex-1 dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                            ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                        </button>
                        <button onclick="document.querySelector('.modal-overlay').remove()" class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                            âŒ Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            loadHomeworkForWeek();
        }

        function loadHomeworkForWeek() {
            const week = parseInt(document.getElementById('grade-week-select').value);
            const myStudents = getStudentsByTeacher(currentUser.id);
            const container = document.getElementById('homework-list');
            
            let html = '';
            
            for (const student of myStudents) {
                const homework = allRecords.find(r => 
                    r.type === 'homework' && 
                    r.code === student.code && 
                    r.week_number === week
                );
                
                const hasHomework = homework && homework.homework_status !== 'pending';
                const grade = homework?.grade || '';
                const notes = homework?.notes || '';
                const text = homework?.homework_text || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ';
                const file = homework?.homework_file || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù';
                const driveUrl = homework?.drive_url || '';
                
                html += `
                    <div class="border-2 border-amber-200 rounded-lg p-4 ${!hasHomework ? 'opacity-50' : ''}">
                        <h3 class="dynamic-text font-bold text-lg mb-2">${student.name} (${student.code})</h3>
                        ${hasHomework ? `
                            <div class="mb-3 p-3 bg-amber-50 rounded-lg">
                                <p class="text-sm font-semibold mb-1">ğŸ“ Ù†Øµ Ø§Ù„ÙˆØ§Ø¬Ø¨:</p>
                                <p class="text-sm">${text}</p>
                                <p class="text-sm font-semibold mt-2 mb-1">ğŸ“ Ø§Ù„Ù…Ù„Ù:</p>
                                <p class="text-sm">${file}</p>
                                ${driveUrl ? `<a href="${driveUrl}" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-600 underline">ğŸ”— ÙØªØ­ ÙÙŠ Drive</a>` : ''}
                            </div>
                            <div class="grid md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-semibold mb-1">Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 100)</label>
                                    <input type="number" id="grade-${student.code}" value="${grade}" min="0" max="100"
                                        class="w-full px-3 py-2 rounded-lg border-2 border-amber-200">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                                    <input type="text" id="notes-${student.code}" value="${notes}" placeholder="Ù…Ù…ØªØ§Ø²ØŒ Ø¬ÙŠØ¯ØŒ Ø§Ù„Ø®..."
                                        class="w-full px-3 py-2 rounded-lg border-2 border-amber-200">
                                </div>
                            </div>
                        ` : `
                            <p class="text-sm opacity-60">Ù„Ù… ÙŠØªÙ… ØªØ³Ù„ÙŠÙ… ÙˆØ§Ø¬Ø¨ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
                        `}
                    </div>
                `;
            }
            
            container.innerHTML = html || '<p class="text-center opacity-60">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>';
        }

        async function saveAllGrades() {
            const week = parseInt(document.getElementById('grade-week-select').value);
            const myStudents = getStudentsByTeacher(currentUser.id);
            
            const saveBtn = event.target;
            saveBtn.disabled = true;
            saveBtn.classList.add('loading');
            saveBtn.innerHTML = '<span class="spinner"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
            
            let successCount = 0;
            
            for (const student of myStudents) {
                const gradeInput = document.getElementById(`grade-${student.code}`);
                const notesInput = document.getElementById(`notes-${student.code}`);
                
                if (!gradeInput || !notesInput) continue;
                
                const grade = parseInt(gradeInput.value) || null;
                const notes = notesInput.value;
                
                const homeworkId = `hw_${student.code}_${week}`;
                const existing = allRecords.find(r => r.id === homeworkId);
                
                if (existing && grade !== null) {
                    const result = await window.dataSdk.update({
                        ...existing,
                        grade: grade,
                        notes: notes,
                        homework_status: 'graded',
                        synced_to_google: false
                    });
                    
                    if (result.isOk) {
                        successCount++;
                        if (googleConfig.scriptUrl) {
                            syncToGoogle({...existing, grade, notes, homework_status: 'graded'});
                        }
                    }
                }
            }
            
            if (successCount > 0) {
                showToast(`ØªÙ… Ø­ÙØ¸ ${successCount} ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­! âœ“`, 'success');
                loadHomeworkForWeek(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            } else {
                showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù„Ù„Ø­ÙØ¸', 'info');
            }
            
            saveBtn.disabled = false;
            saveBtn.classList.remove('loading');
            saveBtn.innerHTML = 'ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª';
        }

        // =====================================================
        // ADMIN DASHBOARD
        // =====================================================

        function renderAdminDashboard() {
            const config = window.elementSdk?.config || defaultConfig;
            const students = getRecordsByType('student');
            const teachers = getRecordsByType('teacher');
            const classes = [...new Set(students.map(s => s.class_name))];
            
            const totalAttendance = allRecords.filter(r => r.type === 'attendance' && r.present).length;
            const totalPossible = students.length * TOTAL_WEEKS;
            const attendancePercentage = totalPossible > 0 ? Math.round((totalAttendance / totalPossible) * 100) : 0;
            
            const pendingHomework = allRecords.filter(r => 
                r.type === 'homework' && 
                r.homework_status === 'submitted'
            ).length;

            document.getElementById('app').innerHTML = `
                <div class="min-h-full p-4">
                    <header class="dynamic-surface rounded-2xl shadow-lg p-6 mb-6 fade-in">
                        <div class="flex justify-between items-center flex-wrap gap-4">
                            <div>
                                <h1 class="dynamic-text text-2xl font-bold">ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h1>
                                <p class="center-name dynamic-text text-3xl font-bold mt-2">${config.center_name || defaultConfig.center_name}</p>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="showGoogleSettings()" class="dynamic-secondary-btn text-white px-6 py-2 rounded-lg font-semibold btn-primary">
                                    ğŸ”— Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google
                                </button>
                                <button onclick="logout()" class="dynamic-secondary-btn text-white px-6 py-2 rounded-lg font-semibold btn-primary">
                                    ğŸšª Ø®Ø±ÙˆØ¬
                                </button>
                            </div>
                        </div>
                    </header>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 slide-up">
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ğŸ‘¥</div>
                            <div class="text-3xl font-bold">${students.length}</div>
                            <div class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ğŸ“</div>
                            <div class="text-3xl font-bold">${teachers.length}</div>
                            <div class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø¯Ø§Ù…</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ğŸ“š</div>
                            <div class="text-3xl font-bold">${classes.length}</div>
                            <div class="text-sm opacity-90">Ø§Ù„ÙØµÙˆÙ„ Ø§ï¿½ï¿½Ø¯Ø±Ø§Ø³ÙŠØ©</div>
                        </div>
                        <div class="stat-card text-white p-6 rounded-xl shadow-lg">
                            <div class="text-4xl mb-2">ğŸ“Š</div>
                            <div class="text-3xl font-bold">${attendancePercentage}%</div>
                            <div class="text-sm opacity-90">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 mb-6 slide-up">
                        <button onclick="showAddTeacher()" class="dynamic-surface p-8 rounded-2xl shadow-lg hover:shadow-xl card-hover">
                            <div class="text-5xl mb-3">ğŸ“</div>
                            <h3 class="dynamic-text text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                            <p class="dynamic-text opacity-60 mt-2">Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø¯Ù… Ù„Ù„Ù†Ø¸Ø§Ù…</p>
                        </button>
                        <button onclick="showAddStudent()" class="dynamic-surface p-8 rounded-2xl shadow-lg hover:shadow-xl card-hover">
                            <div class="text-5xl mb-3">ğŸ‘¦</div>
                            <h3 class="dynamic-text text-2xl font-bold">Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h3>
                            <p class="dynamic-text opacity-60 mt-2">Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø±Ø³ Ù„Ù„Ù†Ø¸Ø§Ù…</p>
                        </button>
                    </div>

                    <div class="dynamic-surface rounded-2xl shadow-lg p-6 mb-6 slide-up">
                        <h2 class="dynamic-text text-2xl font-bold mb-4">ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                        <div class="grid md:grid-cols-3 gap-3">
                            <button onclick="exportDataAsJSON()" class="dynamic-primary-btn text-white py-3 px-6 rounded-lg font-semibold btn-primary">
                                ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ JSON
                            </button>
                            <button onclick="exportDataAsExcel()" class="dynamic-primary-btn text-white py-3 px-6 rounded-lg font-semibold btn-primary">
                                ğŸ“Š ØªÙ†Ø²ÙŠÙ„ Excel
                            </button>
                            <button onclick="importData()" class="bg-green-600 text-white py-3 px-6 rounded-lg font-semibold btn-primary">
                                ğŸ“¤ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            </button>
                        </div>
                    </div>

                    <div class="dynamic-surface rounded-2xl shadow-lg p-6 mb-6 slide-up">
                        <h2 class="dynamic-text text-2xl font-bold mb-4">âš ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø±Ø©</h2>
                        <div class="grid md:grid-cols-2 gap-3">
                            <button onclick="confirmClearStudents()" class="bg-red-600 text-white py-3 px-6 rounded-lg font-semibold btn-primary">
                                ğŸ—‘ï¸ ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†
                            </button>
                            <button onclick="confirmClearTeachers()" class="bg-red-600 text-white py-3 px-6 rounded-lg font-semibold btn-primary">
                                ğŸ—‘ï¸ ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù…
                            </button>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 slide-up">
                        <div class="dynamic-surface rounded-2xl shadow-lg p-6">
                            <h2 class="dynamic-text text-2xl font-bold mb-4">ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø¯Ø§Ù…</h2>
                            <div class="space-y-3">
                                ${teachers.map(teacher => {
                                    const studentCount = getStudentsByTeacher(teacher.id).length;
                                    return `
                                        <div class="border-2 border-amber-200 rounded-lg p-4">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <h3 class="dynamic-text font-bold">${teacher.name}</h3>
                                                    <p class="text-sm opacity-75">ÙƒÙˆØ¯: ${teacher.code}</p>
                                                    <p class="text-sm opacity-75">ğŸ“± ${teacher.phone}</p>
                                                    <p class="text-sm mt-1">ğŸ‘¥ ${studentCount} Ø¯Ø§Ø±Ø³</p>
                                                </div>
                                                <button onclick="confirmDelete('${teacher.id}', 'teacher', '${teacher.name}')" 
                                                    class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm btn-primary">
                                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('') || '<p class="text-center opacity-60">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø¯Ø§Ù… Ø¨Ø¹Ø¯</p>'}
                            </div>
                        </div>

                        <div class="dynamic-surface rounded-2xl shadow-lg p-6">
                            <h2 class="dynamic-text text-2xl font-bold mb-4">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h2>
                            <div class="space-y-3">
                                ${students.map(student => {
                                    const teacher = allRecords.find(r => r.id === student.teacher_id);
                                    const stats = calculateStats(student.code);
                                    return `
                                        <div class="border-2 border-amber-200 rounded-lg p-4">
                                            <div class="flex justify-between items-start gap-3">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <h3 class="dynamic-text font-bold text-lg">${student.name}</h3>
                                                        <span class="text-xs px-2 py-1 rounded ${student.student_type === 'Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">${student.student_type || 'Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯'}</span>
                                                    </div>
                                                    <div class="grid md:grid-cols-2 gap-x-4 gap-y-1 text-sm opacity-75 mb-2">
                                                        <p>ğŸ†” ÙƒÙˆØ¯: ${student.code}</p>
                                                        <p>ğŸ‘¤ ${student.gender || '-'}</p>
                                                        <p>ğŸ“š ${student.grade || student.class_name || '-'}</p>
                                                        <p>ğŸ”¤ ÙØµÙ„: ${student.class_letter || '-'} - ${student.center_class || '-'}</p>
                                                        <p>ğŸ“± ${student.phone1 || student.phone || '-'}</p>
                                                        <p>ğŸ“±2 ${student.phone2 || '-'}</p>
                                                        <p>ğŸ“ Ø§Ù„Ø®Ø§Ø¯Ù…: ${teacher?.name || 'ØºÙŠØ± Ù…ï¿½ï¿½Ø¯Ø¯'}</p>
                                                        <p>â›ª ${student.rank || '-'}</p>
                                                    </div>
                                                    <div class="flex gap-3 text-sm">
                                                        <span>ğŸ“… ${stats.presentDays} Ø­Ø¶ÙˆØ±</span>
                                                        <span>ğŸ“ ${stats.submittedHomework} ÙˆØ§Ø¬Ø¨</span>
                                                        <span>â­ ${stats.average} Ù…ØªÙˆØ³Ø·</span>
                                                    </div>
                                                    <div class="flex gap-2 mt-2 text-xs">
                                                        ${student.form_submitted ? '<span class="px-2 py-1 bg-green-100 text-green-700 rounded">âœ“ Ø§Ø³ØªÙ…Ø§Ø±Ø©</span>' : ''}
                                                        ${student.photo_submitted ? '<span class="px-2 py-1 bg-green-100 text-green-700 rounded">âœ“ ØµÙˆØ±Ø©</span>' : ''}
                                                        ${student.fees_paid ? '<span class="px-2 py-1 bg-green-100 text-green-700 rounded">âœ“ Ø¯ÙØ¹</span>' : ''}
                                                    </div>
                                                </div>
                                                <button onclick="confirmDelete('${student.id}', 'student', '${student.name}')" 
                                                    class="bg-red-500 text-white px-3 py-2 rounded-lg text-sm btn-primary whitespace-nowrap">
                                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('') || '<p class="text-center opacity-60">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙˆÙ† Ø¨Ø¹Ø¯</p>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showAddTeacher() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-2xl w-full">
                    <h2 class="dynamic-text text-2xl font-bold mb-4">â• Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2>
                    <form id="teacher-form" onsubmit="handleAddTeacher(event)" class="space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…</label>
                                <input type="text" id="teacher-code" readonly
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text bg-gray-100"
                                    value="Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
                            </div>
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù… *</label>
                                <input type="text" id="teacher-name" required
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                    placeholder="Ù…Ø«Ø§Ù„: ÙƒØ±ÙŠØ³ØªÙŠÙ† ÙƒÙ…Ø§Ù„">
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                <input type="tel" id="teacher-phone" required
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                    placeholder="01234567890">
                            </div>
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø§Ù„ØªØ®ØµØµ *</label>
                                <select id="teacher-specialty" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ --</option>
                                    <option value="Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³">Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³</option>
                                    <option value="Ø¯Ø±Ø§Ø³ÙŠ ÙÙ‚Ø·">Ø¯Ø±Ø§Ø³ÙŠ ÙÙ‚Ø·</option>
                                    <option value="Ø·Ù‚ÙˆØ³ ÙÙ‚Ø·">Ø·Ù‚ÙˆØ³ ÙÙ‚Ø·</option>
                                    <option value="Ø¥Ø¯Ø§Ø±ÙŠ">Ø¥Ø¯Ø§Ø±ÙŠ</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="flex items-center gap-2 cursor-pointer p-4 border-2 border-amber-200 rounded-lg">
                                    <input type="checkbox" id="teacher-admin" class="w-5 h-5 rounded">
                                    <span class="dynamic-text font-semibold">Ù…Ø³Ø¤ÙˆÙ„ Ø¥Ø¯Ø§Ø±ÙŠ</span>
                                </label>
                            </div>
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                                <input type="password" id="teacher-pwd" required
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                    placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©">
                            </div>
                        </div>

                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ² *</label>
                            <select id="teacher-class" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„ --</option>
                                <option value="ØªÙ…Ù‡ÙŠØ¯ÙŠ">ØªÙ…Ù‡ÙŠØ¯ÙŠ</option>
                                <option value="Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©">Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©</option>
                                <option value="Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©">Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©</option>
                                <option value="Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©">Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©</option>
                                <option value="Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ">Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†">Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†</option>
                            </select>
                        </div>

                        <div class="flex gap-3">
                            <button type="submit" class="flex-1 dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø§Ø¯Ù…
                            </button>
                            <button type="button" onclick="this.closest('.modal-overlay').remove()" 
                                class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function handleAddTeacher(event) {
            event.preventDefault();
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<span class="spinner"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';

            const name = document.getElementById('teacher-name').value;
            const phone = document.getElementById('teacher-phone').value;
            const specialty = document.getElementById('teacher-specialty').value;
            const isAdmin = document.getElementById('teacher-admin').checked;
            const password = document.getElementById('teacher-pwd').value;
            const centerClass = document.getElementById('teacher-class').value;
            
            const teacherData = {
                id: 'teacher_' + Date.now(),
                type: 'teacher',
                name: name,
                code: generateCode('ST'),
                phone: phone,
                specialty: specialty,
                is_admin: isAdmin,
                password: password,
                center_class: centerClass,
                synced_to_google: false,
                created_at: new Date().toISOString()
            };

            const result = await window.dataSdk.create(teacherData);

            if (result.isOk) {
                showToast(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ÙƒÙˆØ¯: ${teacherData.code}`, 'success');
                document.querySelector('.modal-overlay').remove();
                
                if (googleConfig.scriptUrl) {
                    syncToGoogle(teacherData);
                }
            } else {
                showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = 'â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø§Ø¯Ù…';
            }
        }

        function showAddStudent() {
            const teachers = getRecordsByType('teacher');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-4xl w-full max-h-[90%] overflow-y-auto">
                    <h2 class="dynamic-text text-2xl font-bold mb-4">â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h2>
                    <form id="student-form" onsubmit="handleAddStudent(event)" class="space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³ *</label>
                                <select id="student-type" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                    <option value="Ø¯Ø§Ø±ï¿½ï¿½ Ø¬Ø¯ÙŠØ¯">Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯</option>
                                    <option value="Ø¯Ø§Ø±Ø³ Ù‚Ø¯ÙŠÙ…">Ø¯Ø§Ø±Ø³ Ù‚Ø¯ÙŠÙ…</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³</label>
                                <input type="text" id="student-code" readonly
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text bg-gray-100"
                                    value="Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
                            </div>
                        </div>

                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                            <input type="text" id="student-name" required
                                class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                placeholder="Ù…Ø«Ø§Ù„: ÙƒØ§Ø±Ù† Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„ ÙØ¤Ø§Ø¯">
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø§Ù„Ù†ÙˆØ¹ *</label>
                                <select id="student-gender" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                    <option value="">-- Ø§Ø®ØªØ± --</option>
                                    <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                                    <option value="Ø£Ù†Ø«ÙŠ">Ø£Ù†Ø«ÙŠ</option>
                                </select>
                            </div>

                            <div>
                                <label class="block dynamic-text font-semibold mb-2">ï¿½ï¿½Ø§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                                <input type="date" id="student-birthdate"
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                            </div>
                        </div>

                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© *</label>
                            <select id="student-grade" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© --</option>
                                <option value="KG1">KG1</option>
                                <option value="KG2">KG2</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="Ø´Ø¨Ø§Ø¨">Ø´Ø¨Ø§Ø¨</option>
                                <option value="Ø®Ø±ÙŠØ¬ÙŠÙ†">Ø®Ø±ÙŠØ¬ÙŠÙ†</option>
                                <option value="Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø£Ù…ÙˆØ±">Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø£Ù…ÙˆØ±</option>
                            </select>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1</label>
                                <input type="tel" id="student-phone1"
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                    placeholder="01234567890">
                            </div>

                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2</label>
                                <input type="tel" id="student-phone2"
                                    class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                    placeholder="01234567890">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø­Ø±Ù Ø§Ù„ÙØµÙ„ *</label>
                                <select id="student-class-letter" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                    <option value="">-- ï¿½ï¿½Ø®ØªØ± --</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>

                            <div>
                                <label class="block dynamic-text font-semibold mb-2">Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ² *</label>
                                <select id="student-center-class" required class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                    <option value="">-- Ø§Ø®ØªØ± --</option>
                                    <option value="ØªÙ…Ù‡ÙŠØ¯ÙŠ">ØªÙ…Ù‡ÙŠØ¯ÙŠ</option>
                                    <option value="Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©">Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©</option>
                                    <option value="Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©">Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©</option>
                                    <option value="Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©">Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©</option>
                                    <option value="Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ">Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ</option>
                                    <option value="Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†">Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©</label>
                            <select id="student-rank" class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text">
                                <option value="------------------">------------------</option>
                                <option value="Ø£Ø¨ØµØ§Ù„Ø·Ø³">Ø£Ø¨ØµØ§Ù„Ø·Ø³</option>
                                <option value="Ø£ØºÙ†Ø³Ø·Ø³">Ø£ØºÙ†Ø³Ø·Ø³</option>
                                <option value="Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø±Ø³Ø§Ù…Ø©">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø±Ø³Ø§Ù…Ø©</option>
                            </select>
                        </div>

                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <textarea id="student-address" rows="2"
                                class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„..."></textarea>
                        </div>

                        <div class="border-2 border-amber-300 rounded-lg p-4 space-y-3">
                            <h3 class="dynamic-text font-bold text-lg">ğŸ“„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h3>
                            
                            <div>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="student-form-submitted" class="w-5 h-5 rounded">
                                    <span class="dynamic-text font-semibold">ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</span>
                                </label>
                            </div>

                            <div id="form-upload-section" class="hidden">
                                <label class="block dynamic-text font-semibold mb-2">Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label>
                                <div class="border-2 border-dashed border-amber-300 rounded-lg p-4 text-center cursor-pointer hover:bg-amber-50" onclick="document.getElementById('form-file').click()">
                                    <div class="text-3xl mb-2">ğŸ“„</div>
                                    <p class="dynamic-text text-sm">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</p>
                                    <input type="file" id="form-file" class="hidden" accept="image/*,.pdf">
                                </div>
                                <p id="form-file-name" class="text-sm mt-2 dynamic-text"></p>
                            </div>

                            <div>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="student-photo-submitted" class="w-5 h-5 rounded">
                                    <span class="dynamic-text font-semibold">ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</span>
                                </label>
                            </div>

                            <div id="photo-upload-section" class="hidden">
                                <label class="block dynamic-text font-semibold mb-2">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
                                <div class="border-2 border-dashed border-amber-300 rounded-lg p-4 text-center cursor-pointer hover:bg-amber-50" onclick="document.getElementById('photo-file').click()">
                                    <div class="text-3xl mb-2">ğŸ“·</div>
                                    <p class="dynamic-text text-sm">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
                                    <input type="file" id="photo-file" class="hidden" accept="image/*">
                                </div>
                                <p id="photo-file-name" class="text-sm mt-2 dynamic-text"></p>
                            </div>

                            <div>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="student-fees-paid" class="w-5 h-5 rounded">
                                    <span class="dynamic-text font-semibold">ØªÙ… Ø¯ÙØ¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</span>
                                </label>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button type="submit" class="flex-1 dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø±Ø³
                            </button>
                            <button type="button" onclick="this.closest('.modal-overlay').remove()" 
                                class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);

            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ù‚Ø³Ø§Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            document.getElementById('student-form-submitted').onchange = (e) => {
                document.getElementById('form-upload-section').classList.toggle('hidden', !e.target.checked);
            };

            document.getElementById('student-photo-submitted').onchange = (e) => {
                document.getElementById('photo-upload-section').classList.toggle('hidden', !e.target.checked);
            };

            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            document.getElementById('form-file').onchange = (e) => {
                if (e.target.files.length > 0) {
                    document.getElementById('form-file-name').textContent = `ğŸ“ ${e.target.files[0].name}`;
                }
            };

            document.getElementById('photo-file').onchange = (e) => {
                if (e.target.files.length > 0) {
                    document.getElementById('photo-file-name').textContent = `ğŸ“ ${e.target.files[0].name}`;
                }
            };
        }

        async function handleAddStudent(event) {
            event.preventDefault();
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<span class="spinner"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';

            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            const studentType = document.getElementById('student-type').value;
            const code = generateCode('ST');
            const name = document.getElementById('student-name').value;
            const gender = document.getElementById('student-gender').value;
            const birthdate = document.getElementById('student-birthdate').value;
            const grade = document.getElementById('student-grade').value;
            const phone1 = document.getElementById('student-phone1').value;
            const phone2 = document.getElementById('student-phone2').value;
            const classLetter = document.getElementById('student-class-letter').value;
            const centerClass = document.getElementById('student-center-class').value;
            const rank = document.getElementById('student-rank').value;
            const address = document.getElementById('student-address').value;

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²
            const teacher = allRecords.find(t => t.type === 'teacher' && t.center_class === centerClass);
            const teacherId = teacher ? teacher.id : null;

            // Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
            const formSubmitted = document.getElementById('student-form-submitted').checked;
            const photoSubmitted = document.getElementById('student-photo-submitted').checked;
            const feesPaid = document.getElementById('student-fees-paid').checked;

            // Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Drive Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§
            let formFileUrl = null;
            let photoFileUrl = null;

            const formFile = document.getElementById('form-file').files[0];
            if (formFile) {
                const reader = new FileReader();
                const formFileData = await new Promise((resolve) => {
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.readAsDataURL(formFile);
                });
                
                if (googleConfig.scriptUrl && googleConfig.driveFolderId) {
                    formFileUrl = await uploadFileToDrive(formFileData, `Ø§Ø³ØªÙ…Ø§Ø±Ø©_${code}_${formFile.name}`, code, 'form');
                }
            }

            const photoFile = document.getElementById('photo-file').files[0];
            if (photoFile) {
                const reader = new FileReader();
                const photoFileData = await new Promise((resolve) => {
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.readAsDataURL(photoFile);
                });
                
                if (googleConfig.scriptUrl && googleConfig.driveFolderId) {
                    photoFileUrl = await uploadFileToDrive(photoFileData, `ØµÙˆØ±Ø©_${code}_${photoFile.name}`, code, 'photo');
                }
            }

            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const studentData = {
                id: 'student_' + Date.now(),
                type: 'student',
                student_type: studentType,
                code: code,
                name: name,
                gender: gender,
                birthdate: birthdate,
                grade: grade,
                phone1: phone1,
                phone2: phone2,
                class_letter: classLetter,
                center_class: centerClass,
                rank: rank,
                address: address,
                teacher_id: teacherId,
                form_submitted: formSubmitted,
                form_file_url: formFileUrl,
                photo_submitted: photoSubmitted,
                photo_file_url: photoFileUrl,
                fees_paid: feesPaid,
                synced_to_google: false,
                created_at: new Date().toISOString()
            };

            const result = await window.dataSdk.create(studentData);

            if (result.isOk) {
                showToast(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ÙƒÙˆØ¯: ${studentData.code}`, 'success');
                document.querySelector('.modal-overlay').remove();
                
                if (googleConfig.scriptUrl) {
                    syncToGoogle(studentData);
                }
            } else {
                showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø±Ø³', 'error');
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = 'â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø±Ø³';
            }
        }

        function confirmDelete(id, type, name) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-md w-full">
                    <div class="text-center">
                        <div class="text-6xl mb-4">âš ï¸</div>
                        <h2 class="dynamic-text text-2xl font-bold mb-4">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
                        <p class="dynamic-text mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù: <strong>${name}</strong>ØŸ</p>
                        <div class="flex gap-3">
                            <button onclick="deleteRecord('${id}')" class="flex-1 bg-red-500 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ—‘ï¸ Ø­Ø°Ù
                            </button>
                            <button onclick="this.closest('.modal-overlay').remove()" 
                                class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function deleteRecord(id) {
            const record = allRecords.find(r => r.id === id);
            if (!record) return;

            const result = await window.dataSdk.delete(record);

            if (result.isOk) {
                showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.querySelector('.modal-overlay').remove();
            } else {
                showToast('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
            }
        }

        function showGoogleSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-2xl w-full max-h-[90%] overflow-y-auto">
                    <h2 class="dynamic-text text-2xl font-bold mb-4">ï¿½ï¿½ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Google Apps Script URL</label>
                            <input type="url" id="script-url" value="${googleConfig.scriptUrl}"
                                class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
                            <p class="text-sm opacity-60 mt-1">Ø±Ø§Ø¨Ø· Web App Ù…Ù† Google Apps Script</p>
                        </div>
                        
                        <div>
                            <label class="block dynamic-text font-semibold mb-2">Google Drive Folder ID</label>
                            <input type="text" id="folder-id" value="${googleConfig.driveFolderId}"
                                class="w-full px-4 py-3 rounded-lg border-2 border-amber-200 dynamic-text"
                                placeholder="1AbCdEfGhIjKlMnOpQrStUvWxYz">
                            <p class="text-sm opacity-60 mt-1">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙÙŠ Google Drive Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</p>
                        </div>

                        <div class="bg-amber-50 p-4 rounded-lg">
                            <h3 class="font-bold mb-2">ğŸ“š ÙƒÙŠÙÙŠØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª:</h3>
                            <ol class="text-sm space-y-2 opacity-75">
                                <li><strong>1. Google Apps Script URL:</strong> Ø¨Ø¹Ø¯ Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙƒÙ€ Web AppØŒ Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø±</li>
                                <li><strong>2. Drive Folder ID:</strong> Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙÙŠ DriveØŒ Ø§Ù†Ø³Ø® Ø§Ù„Ø¬Ø²Ø¡ Ø¨Ø¹Ø¯ /folders/</li>
                                <li class="text-xs mt-2">Ù…Ø«Ø§Ù„: https://drive.google.com/drive/folders/<span class="bg-yellow-200">1AbCdEf...</span></li>
                            </ol>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="testGoogleConnection()" class="flex-1 bg-blue-500 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                            </button>
                            <button onclick="saveGoogleSettings()" class="flex-1 dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                            </button>
                        </div>
                        
                        <button onclick="syncAllToGoogle()" class="w-full dynamic-secondary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                            ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Google
                        </button>

                        <button onclick="document.querySelector('.modal-overlay').remove()" 
                            class="w-full bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                            âŒ Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveGoogleSettings() {
            const scriptUrl = document.getElementById('script-url').value;
            const folderId = document.getElementById('folder-id').value;
            
            googleConfig = {
                scriptUrl: scriptUrl,
                driveFolderId: folderId
            };
            
            localStorage.setItem('googleConfig', JSON.stringify(googleConfig));
            showToast('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Ø¨Ù†Ø¬Ø§Ø­! âœ“', 'success');
        }

        async function syncAllToGoogle() {
            if (!googleConfig.scriptUrl) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google ï¿½ï¿½ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }

            showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...', 'info');
            
            let synced = 0;
            for (const record of allRecords) {
                if (!record.synced_to_google && ['student', 'teacher', 'attendance', 'homework'].includes(record.type)) {
                    await syncToGoogle(record);
                    synced++;
                }
            }
            
            showToast(`ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© ${synced} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­! ï¿½ï¿½ï¿½`, 'success');
        }

        // =====================================================
        // DATA EXPORT & IMPORT FUNCTIONS
        // =====================================================

        function exportDataAsJSON() {
            const dataToExport = {
                students: allRecords.filter(r => r.type === 'student'),
                teachers: allRecords.filter(r => r.type === 'teacher'),
                attendance: allRecords.filter(r => r.type === 'attendance'),
                homework: allRecords.filter(r => r.type === 'homework'),
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showToast('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© JSON Ø¨Ù†Ø¬Ø§Ø­! âœ“', 'success');
        }

        function exportDataAsExcel() {
            const students = allRecords.filter(r => r.type === 'student');
            const teachers = allRecords.filter(r => r.type === 'teacher');

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ CSV
            let csvContent = '\uFEFF'; // BOM for UTF-8
            
            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†
            csvContent += 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†\n';
            csvContent += 'Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³,ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³,Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³,Ø§Ù„Ù†ÙˆØ¹,ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯,Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©,Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1,Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2,Ø­Ø±Ù Ø§Ù„ÙØµÙ„,Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²,Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©,Ø§Ù„Ø¹Ù†ÙˆØ§Ù†,Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©,Ø§Ù„ØµÙˆØ±Ø©,Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©\n';
            
            students.forEach(s => {
                csvContent += `"${s.student_type || ''}","${s.code}","${s.name}","${s.gender || ''}","${s.birthdate || ''}","${s.grade || ''}","${s.phone1 || ''}","${s.phone2 || ''}","${s.class_letter || ''}","${s.center_class || ''}","${s.rank || ''}","${s.address || ''}","${s.form_submitted ? 'TRUE' : 'FALSE'}","${s.photo_submitted ? 'TRUE' : 'FALSE'}","${s.fees_paid ? 'TRUE' : 'FALSE'}"\n`;
            });

            csvContent += '\n\nØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù…\n';
            csvContent += 'ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…,Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…,Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„ØªØ®ØµØµ,Ø¥Ø¯Ø§Ø±ÙŠ,ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±,Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²\n';
            
            teachers.forEach(t => {
                csvContent += `"${t.code}","${t.name}","${t.phone}","${t.specialty || ''}","${t.is_admin ? 'TRUE' : 'FALSE'}","${t.password}","${t.center_class || ''}"\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            URL.revokeObjectURL(url);
            showToast('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Excel Ø¨Ù†Ø¬Ø§Ø­! âœ“', 'success');
        }

        function importData() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-lg w-full">
                    <h2 class="dynamic-text text-2xl font-bold mb-4">ğŸ“¤ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                    <div class="space-y-4">
                        <div class="border-2 border-dashed border-amber-300 rounded-lg p-8 text-center cursor-pointer hover:bg-amber-50" onclick="document.getElementById('import-file').click()">
                            <div class="text-5xl mb-3">ğŸ“</div>
                            <p class="dynamic-text font-semibold">Ø§Ø®ØªØ± Ù…Ù„Ù JSON</p>
                            <p class="text-sm opacity-60 mt-2">Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</p>
                            <input type="file" id="import-file" class="hidden" accept=".json">
                        </div>
                        <p id="import-file-name" class="text-sm dynamic-text text-center"></p>
                        <div class="flex gap-3">
                            <button onclick="handleImport()" class="flex-1 dynamic-primary-btn text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ“¤ Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                            </button>
                            <button onclick="this.closest('.modal-overlay').remove()" class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            document.getElementById('import-file').onchange = (e) => {
                if (e.target.files.length > 0) {
                    document.getElementById('import-file-name').textContent = `ğŸ“ ${e.target.files[0].name}`;
                }
            };
        }

        async function handleImport() {
            const fileInput = document.getElementById('import-file');
            if (fileInput.files.length === 0) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù JSON', 'error');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = async (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    let imported = 0;
                    const allData = [
                        ...(data.students || []),
                        ...(data.teachers || []),
                        ...(data.attendance || []),
                        ...(data.homework || [])
                    ];

                    for (const record of allData) {
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø³Ø¬Ù„
                        const exists = allRecords.find(r => r.id === record.id);
                        if (!exists) {
                            const result = await window.dataSdk.create(record);
                            if (result.isOk) {
                                imported++;
                            }
                        }
                    }

                    showToast(`ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© ${imported} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­! âœ“`, 'success');
                    document.querySelector('.modal-overlay').remove();
                } catch (error) {
                    showToast('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };

            reader.readAsText(file);
        }

        function confirmClearStudents() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-md w-full">
                    <div class="text-center">
                        <div class="text-6xl mb-4">âš ï¸</div>
                        <h2 class="dynamic-text text-2xl font-bold mb-4">ØªØ­Ø°ÙŠØ±!</h2>
                        <p class="dynamic-text mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù <strong>Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</strong>ØŸ<br>Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
                        <div class="flex gap-3">
                            <button onclick="clearStudentsData()" class="flex-1 bg-red-600 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
                            </button>
                            <button onclick="this.closest('.modal-overlay').remove()" class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function clearStudentsData() {
            const students = allRecords.filter(r => r.type === 'student');
            const attendance = allRecords.filter(r => r.type === 'attendance');
            const homework = allRecords.filter(r => r.type === 'homework');
            
            let deleted = 0;
            
            for (const record of [...students, ...attendance, ...homework]) {
                const result = await window.dataSdk.delete(record);
                if (result.isOk) {
                    deleted++;
                }
            }

            showToast(`ØªÙ… Ø­Ø°Ù ${deleted} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­! âœ“`, 'success');
            document.querySelector('.modal-overlay').remove();

            // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Google Sheets
            if (googleConfig.scriptUrl) {
                await fetch(googleConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'clearStudents' })
                });
            }
        }

        function confirmClearTeachers() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="modal-content dynamic-surface rounded-2xl shadow-2xl p-6 max-w-md w-full">
                    <div class="text-center">
                        <div class="text-6xl mb-4">âš ï¸</div>
                        <h2 class="dynamic-text text-2xl font-bold mb-4">ØªØ­Ø°ÙŠØ±!</h2>
                        <p class="dynamic-text mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù <strong>Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù…</strong>ØŸ<br>Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
                        <div class="flex gap-3">
                            <button onclick="clearTeachersData()" class="flex-1 bg-red-600 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
                            </button>
                            <button onclick="this.closest('.modal-overlay').remove()" class="flex-1 bg-gray-400 text-white py-3 px-6 rounded-lg font-bold btn-primary">
                                âŒ Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function clearTeachersData() {
            const teachers = allRecords.filter(r => r.type === 'teacher');
            
            let deleted = 0;
            
            for (const record of teachers) {
                const result = await window.dataSdk.delete(record);
                if (result.isOk) {
                    deleted++;
                }
            }

            showToast(`ØªÙ… Ø­Ø°Ù ${deleted} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­! âœ“`, 'success');
            document.querySelector('.modal-overlay').remove();

            // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Google Sheets
            if (googleConfig.scriptUrl) {
                await fetch(googleConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'clearTeachers' })
                });
            }
        }

        // =====================================================
        // INITIALIZE ON LOAD
        // =====================================================

        window.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a189859729be28a',t:'MTc2MzY0ODUwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
